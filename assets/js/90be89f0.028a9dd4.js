"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3532],{10310:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"lab/04/index","title":"04 - PWM & ADC","description":"Pulse Width Modulation and Analog to Digital Converters","source":"@site/versioned_docs/version-fils_en/lab/04/index.md","sourceDirName":"lab/04","slug":"/lab/04","permalink":"/docs/fils_en/lab/04","draft":false,"unlisted":false,"editUrl":"https://github.com/UPB-PMRust/upb-pmrust.github.io/edit/main/website/versioned_docs/version-fils_en/lab/04/index.md","tags":[],"version":"fils_en","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"description":"Pulse Width Modulation and Analog to Digital Converters","slug":"/lab/04"},"sidebar":"tutorialSidebar","previous":{"title":"03 - Exceptions & Interrupts","permalink":"/docs/fils_en/lab/03"},"next":{"title":"05 - Asynchronous Development","permalink":"/docs/fils_en/lab/05"}}');var a=n(74848),t=n(28453);const l={sidebar_position:5,description:"Pulse Width Modulation and Analog to Digital Converters",slug:"/lab/04"},r="04 - PWM & ADC",c={},h=[{value:"Resources",id:"resources",level:2},{value:"Timing",id:"timing",level:2},{value:"Clocks",id:"clocks",level:3},{value:"Counters",id:"counters",level:3},{value:"SysTick",id:"systick",level:4},{value:"Timers",id:"timers",level:3},{value:"Analog and Digital Signals",id:"analog-and-digital-signals",level:2},{value:"Pulse-Width Modulation (PWM)",id:"pulse-width-modulation-pwm",level:2},{value:"Examples of hardware controlled through PWM",id:"examples-of-hardware-controlled-through-pwm",level:3},{value:"How to wire an RGB LED",id:"how-to-wire-an-rgb-led",level:4},{value:"PWM in Embassy-rs",id:"pwm-in-embassy-rs",level:3},{value:"Analog-to-Digital Converter (ADC)",id:"analog-to-digital-converter-adc",level:2},{value:"Nyquist-Shannon Sampling Theorem",id:"nyquist-shannon-sampling-theorem",level:3},{value:"Examples of analog sensors",id:"examples-of-analog-sensors",level:3},{value:"How to wire a photoresistor",id:"how-to-wire-a-photoresistor",level:4},{value:"ADC in Embassy-rs",id:"adc-in-embassy-rs",level:3},{value:"Exercises",id:"exercises",level:2}];function o(e){const s={a:"a",admonition:"admonition",annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"04---pwm--adc",children:"04 - PWM & ADC"})}),"\n",(0,a.jsx)(s.p,{children:"This lab will teach you the difference between digital and analog signals, how to simulate analog signals by using Pulse Width Modulation (PWM) and how to convert analog signals to digital ones using Analog-to-Digital Converters (ADC)."}),"\n",(0,a.jsx)(s.h2,{id:"resources",children:"Resources"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Raspberry Pi Ltd"}),", ",(0,a.jsx)(s.em,{children:(0,a.jsx)(s.a,{href:"https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf",children:"RP2040 Datasheet"})})]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Chapter 2 - ",(0,a.jsx)(s.em,{children:"System Description"})]}),"\n",(0,a.jsxs)(s.li,{children:["Chapter 2.15 - ",(0,a.jsx)(s.em,{children:"Clocks"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Subchapter 2.15.1"}),"\n",(0,a.jsx)(s.li,{children:"Subchapter 2.15.2"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["Chapter 4 - ",(0,a.jsx)(s.em,{children:"Peripherals"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Chapter 4.5 - ",(0,a.jsx)(s.em,{children:"PWM"})]}),"\n",(0,a.jsxs)(s.li,{children:["Chapter 4.6 - ",(0,a.jsx)(s.em,{children:"Timer"})]}),"\n",(0,a.jsxs)(s.li,{children:["Chapter 4.9 - ",(0,a.jsx)(s.em,{children:"ADC and Temperature Sensor"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Subchapter 4.9.1"}),"\n",(0,a.jsx)(s.li,{children:"Subchapter 4.9.2"}),"\n",(0,a.jsx)(s.li,{children:"Subchapter 4.9.5"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Paul Denisowski"}),", ",(0,a.jsx)(s.em,{children:(0,a.jsx)(s.a,{href:"https://www.youtube.com/watch?v=nXFoVSN3u-E",children:"Understanding PWM"})})]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"timing",children:"Timing"}),"\n",(0,a.jsx)(s.p,{children:"In embedded applications, keeping track of time is crucial. Even for the simple task of blinking a led at a certain time interval, we need a reference of time that is constant and precise."}),"\n",(0,a.jsx)(s.h3,{id:"clocks",children:"Clocks"}),"\n",(0,a.jsx)(s.p,{children:"A clock is a piece of hardware that provides us with that reference. Its purpose is to oscillate at a fixed frequency and provide a signal that switches from high to low at a fixed interval."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"ClockSignal",src:n(76195).A+"",width:"785",height:"228"})}),"\n",(0,a.jsx)(s.p,{children:"The most precise type of clock is the crystal oscillator (XOSC). The reason why it is so accurate is because it uses the crystal's natural vibration frequency to create the clock signal. This clock is usually external to the processor itself, but the processor also has an internal clock (ROSC) that is less accurate and that can be used in cases where small variations of clock  pulses are negligeable. When using the USB protocol, for instance, a more stable clock signal is required, therefore the XOSC is necessary.\nThe crystal oscillator on the Raspberry Pi Pico board has a frequency of 12MHz."}),"\n",(0,a.jsx)(s.p,{children:"This clock signal is just a reference, and most of the time we need to adjust it to our needs. This is done by either multiplying or dividing the clock, or in other words, elevating or lowering the frequency of the clock. For example, the RP2040 itself runs on a 125MHz clock, so the crystal oscillator frequency of 12MHz is multiplied (this is done using a method called Phase-Locked Loop)."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"RPCrystal",src:n(47171).A+"",width:"591",height:"371"})}),"\n",(0,a.jsx)(s.h3,{id:"counters",children:"Counters"}),"\n",(0,a.jsx)(s.p,{children:"A counter is a piece of hardware logic that counts, as its name suggests. Every clock cycle, it increments the value of a register, until it overflows and starts anew."}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsx)(s.p,{children:"A regular counter on 8 bits would count up from 0 to 255, then loop back to 0 and continue counting."})}),"\n",(0,a.jsx)(s.p,{children:"In theory a counter is associated with 3 registers:"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Register"}),(0,a.jsx)(s.th,{children:"Description"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"value"})}),(0,a.jsx)(s.td,{children:"the current value of the counter"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"direction"})}),(0,a.jsx)(s.td,{children:"whether the counter is counting UP or DOWN"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"reset"})}),(0,a.jsx)(s.td,{children:"if the direction is UP, the value at which the counter resets to 0; if the direction is DOWN, the value at which the counter reset after reaching 0"})]})]})]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Counter",src:n(32759).A+"",width:"381",height:"294"})}),"\n",(0,a.jsx)(s.p,{children:"The way the counter works here is that it increments/decrements every clock cycle and checks whether or not it has reached its reset value. If is has, then it resets to its initial value and starts all over again."}),"\n",(0,a.jsx)(s.h4,{id:"systick",children:"SysTick"}),"\n",(0,a.jsx)(s.p,{children:"The ARM Cortex-M uses the SysTick time counter to keep track of time. This counter is decremented every microsecond, and when it reaches 0, it triggers an exception and then resets."}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"SYST_CVR"})," register - the value of the timer itself"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"SYST_RVR"})," register - the reset value"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"SYST_CSR_SET"})," register:","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"ENABLE"})," field - enable/disable the counter"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"TICKINT"})," field - enable/disable exception on reaching 0"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"timers",children:"Timers"}),"\n",(0,a.jsxs)(s.p,{children:["Until now, we have been able to blink a led at a certain time interval, by busy waiting a while between each led toggle. The technique we used so far was asking the processor to skip a clock cycle a number of times, or by calling the processor instruction ",(0,a.jsx)(s.code,{children:"nop"})," (no operation) in a loop."]}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsxs)(s.p,{children:["This method is not ideal, since the ",(0,a.jsx)(s.code,{children:"nop"})," instruction stalls the processor and wastes valuable time that could otherwise be used to do other things in the meantime. To optimize this, we can use ",(0,a.jsx)(s.em,{children:"alarms"}),"."]})}),"\n",(0,a.jsxs)(s.p,{children:["An ",(0,a.jsx)(s.strong,{children:"alarm"})," is a counter that triggers an interrupt every time it reaches a certain value. This way, an alarm can be set to trigger after a specific interval of time, and while it's waiting, the main program can continue executing instructions, and so it is not blocked. When the alarm reaches the chosen value, it goes off and triggers an interrupt that can then be handled in its specific ISR."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Alarm",src:n(78600).A+"",width:"558",height:"469"})}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsxs)(s.p,{children:["The RP2040 timer is fully monotomic, meaning it can never truly overflow. Its value is stored on 64 bits and increments every 1 microsecond, which means that the last value it can increment to before overflowing is 2",(0,a.jsx)("sup",{children:"64-1"}),", which the equivalent of roughly 500,000 years. This timer allows 4 different alarms, which can be used independently (",(0,a.jsx)(s.code,{children:"TIMER_IRQ_0/1/2/3"}),")."]})}),"\n",(0,a.jsx)(s.h2,{id:"analog-and-digital-signals",children:"Analog and Digital Signals"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Analog signals"})," are a representation of real-world data. They communicate information in a continuous function of time. They are smooth and time-varying waves, and contain an infinite number of values within the continuous range. An example of an analog signal would be sound, or the human voice."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"AnalogSignal",src:n(51247).A+"",width:"1085",height:"372"})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Digital signals"})," are a discrete representation of data. They are represented by a sequence of binary values, taken from a finite set of possible numbers. They are square and discrete waves. In most cases, they are represented by two values: 0 and 1 (or 0V and 5V). Digital representation of signals is usually used in hardware."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"DigitalSignal",src:n(82825).A+"",width:"1067",height:"396"})}),"\n",(0,a.jsx)(s.h2,{id:"pulse-width-modulation-pwm",children:"Pulse-Width Modulation (PWM)"}),"\n",(0,a.jsxs)(s.p,{children:["Up to now, we learned to turn a led on and off, or in other words, set a led's intensity to 100% or 0%. What if we wanted to turn on the led only at 50% intensity? We only have a two-level digital value, 0 or 1, so technically a value of 0.5 is not possible. What we can do is simulate this analog signal, so that it ",(0,a.jsx)(s.em,{children:"looks"})," like the led is at half intensity."]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Pulse-Width Modulation"})," is a method of simulating an analog signal using a digital one, by varying the width of the generated square wave."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"PWMExample",src:n(68991).A+"",width:"731",height:"219"})}),"\n",(0,a.jsx)(s.admonition,{type:"note",children:(0,a.jsx)(s.p,{children:"We can think of the simulated analog signal being directly proportional to the change in digital signal pulse size. The larger the square wave at a given period T, the higher the average analog amplitude output for that period."})}),"\n",(0,a.jsxs)(s.p,{children:["The ",(0,a.jsx)(s.strong,{children:"duty cycle"})," of the signal is the percentage of time per period that the signal is high."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"DutyCycle",src:n(29).A+"",width:"494",height:"259"})}),"\n",(0,a.jsx)(s.p,{children:"So if we wanted our led to be at 50% intensity, we would choose a duty cycle of 50%. By quickly switching between high and low, the led appears to the human eye as being at only 50% intensity, when in reality, it's only on at max intensity 50% of the time, and off the rest of the time."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"PWMLed",src:n(49185).A+"",width:"440",height:"200"})}),"\n",(0,a.jsx)(s.span,{className:"katex-display",children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"d"}),(0,a.jsx)(s.mi,{children:"u"}),(0,a.jsx)(s.mi,{children:"t"}),(0,a.jsx)(s.mi,{children:"y"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"_"}),(0,a.jsx)(s.mi,{children:"c"}),(0,a.jsx)(s.mi,{children:"y"}),(0,a.jsx)(s.mi,{children:"c"}),(0,a.jsx)(s.mi,{children:"l"}),(0,a.jsx)(s.mi,{children:"e"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsxs)(s.mfrac,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"t"}),(0,a.jsx)(s.mi,{children:"i"}),(0,a.jsx)(s.mi,{children:"m"}),(0,a.jsx)(s.mi,{children:"e"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"_"}),(0,a.jsx)(s.mi,{children:"o"}),(0,a.jsx)(s.mi,{children:"n"})]}),(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"p"}),(0,a.jsx)(s.mi,{children:"e"}),(0,a.jsx)(s.mi,{children:"r"}),(0,a.jsx)(s.mi,{children:"i"}),(0,a.jsx)(s.mi,{children:"o"}),(0,a.jsx)(s.mi,{children:"d"})]})]}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"%"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\nduty\\_cycle = \\frac{time\\_on}{period} \\%\n"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1.0044em",verticalAlign:"-0.31em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"u"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,a.jsx)(s.span,{className:"mord",style:{marginRight:"0.02778em"},children:"_"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"cyc"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"2.24em",verticalAlign:"-0.8804em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,a.jsx)(s.span,{className:"mfrac",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"1.3595em"},children:[(0,a.jsxs)(s.span,{style:{top:"-2.314em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"er"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"i"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"d"})]})]}),(0,a.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,a.jsxs)(s.span,{style:{top:"-3.7em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"im"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,a.jsx)(s.span,{className:"mord",style:{marginRight:"0.02778em"},children:"_"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"n"})]})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.8804em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mclose nulldelimiter"})]}),(0,a.jsx)(s.span,{className:"mord",children:"%"})]})]})]})}),"\n",(0,a.jsxs)(s.p,{children:["For the RP2040, to generate this PWM signal, a ",(0,a.jsx)(s.em,{children:"counter"})," is used. The PWM counter is controlled by these registers (",(0,a.jsx)(s.code,{children:"X"})," can be from 0-7, depending on the channel):"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"CHX_CTR"})," - the actual value of the counter"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"CHX_CC"})," - the value that the counter will compare to"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"CHX_TOP"})," - the value at which the counter will reset (or ",(0,a.jsx)(s.em,{children:"wrap"}),")"]}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["When ",(0,a.jsx)(s.code,{children:"CHX_CTR"})," is reset, the value of the output signal is 1. The counter counts up until it reaches ",(0,a.jsx)(s.code,{children:"CHX_CC"}),", after which the value of the output signal becomes 0. The counter continues to count until it reaches ",(0,a.jsx)(s.code,{children:"CHX_TOP"}),", and then the signal becomes 1 again. This way, by choosing the value of ",(0,a.jsx)(s.code,{children:"CHX_CC"}),", we set the duty cycle of the PWM signal."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"PWMRP2040",src:n(94306).A+"",width:"1502",height:"960"})}),"\n",(0,a.jsx)(s.p,{children:"On RP2040, all GPIO pins support PWM. Every two pins share a PWM slice, and each one of them is on a separate channel."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"RP2040PWMPins",src:n(89290).A+"",width:"1902",height:"430"})}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsx)(s.p,{children:"This means that in order to use a pin as PWM, we need to know what channel it's on, and which output it uses (A or B)."})}),"\n",(0,a.jsx)(s.h3,{id:"examples-of-hardware-controlled-through-pwm",children:"Examples of hardware controlled through PWM"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"leds"}),"\n",(0,a.jsx)(s.li,{children:"motors"}),"\n",(0,a.jsx)(s.li,{children:"buzzers"}),"\n",(0,a.jsx)(s.li,{children:"RGB leds (what we will be using for this lab)"}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["An ",(0,a.jsx)(s.strong,{children:"RGB"})," LED is a led that can emit any color, using a combination of red, green and blue light. On the inside, it's actually made up of 3 separate leds:"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.em,{children:"R"})," led - to control the intensity of the ",(0,a.jsx)(s.em,{children:"red"})," light"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.em,{children:"G"})," led - to control the intensity of the ",(0,a.jsx)(s.em,{children:"green"})," light"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.em,{children:"B"})," led - to control the intensity of the ",(0,a.jsx)(s.em,{children:"blue"})," light"]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"By using PWM on the R, G and B leds, we can control each of their intensity to represent any color."}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsx)(s.p,{children:"For example, if we wanted to create the color purple, we would set the intensity of red and blue to 100%, and the intensity of green to 0%."})}),"\n",(0,a.jsx)(s.p,{children:"There are two different types of RGB LEDs:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"common cathode: all LED cathodes are connected together. A LOW signal means off, and a HIGH signal means on at max intensity."}),"\n",(0,a.jsx)(s.li,{children:"common anode: all LED anodes are connected together. A LOW signal means on at max intensity, and a HIGH signal means off."}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"CommonAnodeCommonCathode",src:n(35562).A+"",width:"822",height:"358"})}),"\n",(0,a.jsx)(s.admonition,{type:"warning",children:(0,a.jsxs)(s.p,{children:["For this lab, we will be using ",(0,a.jsx)(s.strong,{children:"common anode"})," RGB LEDs, which means that the PWM signal should be ",(0,a.jsx)(s.em,{children:"opposite"}),". 0 will be 100% intensity, and 1 will be 0% intensity."]})}),"\n",(0,a.jsx)(s.h4,{id:"how-to-wire-an-rgb-led",children:"How to wire an RGB LED"}),"\n",(0,a.jsxs)(s.p,{children:["For ",(0,a.jsx)(s.strong,{children:"common cathode"})," RGB LEDs, we must tie each of the 3 color led legs to GPIO pins in series with a ",(0,a.jsx)(s.em,{children:"resistance"}),", and connect the fourth pin to ",(0,a.jsx)(s.strong,{children:"GND"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["For ",(0,a.jsx)(s.strong,{children:"common anode"})," RGB LEDs, we must also tie each of the 3 color led legs to GPIO pins in series with a ",(0,a.jsx)(s.em,{children:"resistance"}),", but connect the fourth pin to ",(0,a.jsx)(s.strong,{children:"3V3"})," instead."]}),"\n",(0,a.jsx)(s.admonition,{type:"danger",children:(0,a.jsx)(s.p,{children:"Do not forget to tie a resistance to each color pin of the RGB LED!"})}),"\n",(0,a.jsx)(s.h3,{id:"pwm-in-embassy-rs",children:"PWM in Embassy-rs"}),"\n",(0,a.jsx)(s.p,{children:"First, we need a reference to all peripherals, as usual."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"// Initialize peripherals\nlet peripherals = embassy_rp::init(Default::default());\n"})}),"\n",(0,a.jsxs)(s.p,{children:["In order to modify the PWM counter configurations, we need to create a ",(0,a.jsx)(s.code,{children:"Config"})," for our PWM."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"use embassy_rp::pwm::Config as ConfigPwm; // PWM config\n\n// Create config for PWM slice\nlet mut config: ConfigPwm = Default::default();\n// Set top value (value at which PWM counter will reset)\nconfig.top = 0x8000; // in HEX, equals 32768 in decimal\n// Set compare value (counter value at which the PWM signal will change from 1 to 0)\nconfig.compare_a = config.top / 2;\n"})}),"\n",(0,a.jsx)(s.p,{children:"In the example above:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"top"})," is the field from ",(0,a.jsx)(s.code,{children:"Config"})," that will define the value at which the counter will reset back to 0"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"compare_a"})," is the field from ",(0,a.jsx)(s.code,{children:"Config"})," that will define the value at which the PWM signal will switch from 1 to 0\nIn this case, ",(0,a.jsx)(s.code,{children:"config.compare_a"})," is half of ",(0,a.jsx)(s.code,{children:"config.top"}),". This means that the duty cycle of the generated PWM signal will be 50%, or, in other words, that the PWM signal will switch from 1 to 0 halfway through each period."]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"To select the pin that we want to use for PWM, we need to create a new PWM driver that uses the correct channel and output for our pin."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"// Create PWM driver for pin 0\nlet mut pwm = Pwm::new_output_a( // output A\n    peripherals.PWM_CH0, // channel 0\n    peripherals.PIN_0, // pin 0\n    config.clone()\n);\n"})}),"\n",(0,a.jsx)(s.admonition,{type:"warning",children:(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"The code above is an example for pin 0. You need to modify the channel, output and pin depending on the PWM pin you choose to use!"}),"\n",(0,a.jsxs)(s.li,{children:["The value of ",(0,a.jsx)(s.code,{children:"compare_a"})," or ",(0,a.jsx)(s.code,{children:"compare_b"})," must be changed depending on the desired duty cycle!"]}),"\n"]})}),"\n",(0,a.jsxs)(s.p,{children:["If we decide to modify the value of ",(0,a.jsx)(s.code,{children:"compare_a"})," or ",(0,a.jsx)(s.code,{children:"compare_b"}),", we have to update the configuration for the PWM."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"config.compare_a += 100; // modified value of `compare_a`\npwm.set_config(&config); // set the new configuration for PWM\n"})}),"\n",(0,a.jsx)(s.h2,{id:"analog-to-digital-converter-adc",children:"Analog-to-Digital Converter (ADC)"}),"\n",(0,a.jsxs)(s.p,{children:["Now we know how to represent an analog signal using digital signals. There are plenty of cases in which we need to know how to transform an analog signal into a digital one, for example a temperature reading, or the voice of a person. This means that we need to correctly represent a continuous wave of infinite values to a discrete wave of a finite set of values.\nFor this, we need to sample the analog signal periodically, in other words to measure the analog signal at a fixed interval of time. This is done by using an ",(0,a.jsx)(s.strong,{children:"Analog-to-Digital converter"}),"."]}),"\n",(0,a.jsx)(s.p,{children:"The ADC has two important parameters that define the quality of the signal representation:"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Parameter"}),(0,a.jsx)(s.th,{children:"Description"}),(0,a.jsx)(s.th,{children:"Impact on quality"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Sampling Rate"}),(0,a.jsx)(s.td,{children:"Frequency at which a new sample is read"}),(0,a.jsx)(s.td,{children:"The higher the sampling rate, the more samples we get, so the more accurate the representation of the signal"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Resolution"}),(0,a.jsx)(s.td,{children:"Number of bits which we can use in order to store the value of the sample"}),(0,a.jsx)(s.td,{children:"The higher the resolution, the more values we can store, so the more accurate the representation"})]})]})]}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsx)(s.p,{children:"For example, a resolution of 8 bits means that we can approximate the analog signal to a value from 0 to 255."})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"ADCSampling",src:n(1175).A+"",width:"587",height:"443"})}),"\n",(0,a.jsx)(s.h3,{id:"nyquist-shannon-sampling-theorem",children:"Nyquist-Shannon Sampling Theorem"}),"\n",(0,a.jsxs)(s.p,{children:["The ",(0,a.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Nyquist%E2%80%93Shannon_sampling_theorem",children:"Nyquist-Shannon sampling theorem"})," serves as a bridge between continuous-time signals and discrete-time signals. It establishes a link between the frequency range of a signal and the sample rate required to avoid a type of distortion called ",(0,a.jsx)(s.em,{children:"aliasing"}),". Aliasing occurs when a signal is not sampled fast enough to construct an accurate waveform representation."]}),"\n",(0,a.jsx)(s.p,{children:"For an analog signal to be represented without loss of information, the conversion needs to satisfy the following formula:"}),"\n",(0,a.jsx)(s.span,{className:"katex-display",children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"s"}),(0,a.jsx)(s.mi,{children:"a"}),(0,a.jsx)(s.mi,{children:"m"}),(0,a.jsx)(s.mi,{children:"p"}),(0,a.jsx)(s.mi,{children:"l"}),(0,a.jsx)(s.mi,{children:"i"}),(0,a.jsx)(s.mi,{children:"n"}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"g"}),(0,a.jsx)(s.mi,{children:"f"})]}),(0,a.jsx)(s.mo,{children:">"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsx)(s.mn,{children:"2"}),(0,a.jsx)(s.mo,{children:"\xd7"}),(0,a.jsx)(s.mi,{children:"m"}),(0,a.jsx)(s.mi,{children:"a"}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"x"}),(0,a.jsx)(s.mi,{children:"f"})]})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"sampling_f >= 2 \\times max_{f}"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.9805em",verticalAlign:"-0.2861em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"am"}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"pl"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"in"}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.10764em"},children:"f"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:">="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.7278em",verticalAlign:"-0.0833em"}}),(0,a.jsx)(s.span,{className:"mord",children:"2"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"\xd7"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"ma"}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",children:"x"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.10764em"},children:"f"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})]})]})}),"\n",(0,a.jsxs)(s.p,{children:["The analog signal needs to be sampled at a frequency greater than twice the ",(0,a.jsx)(s.em,{children:"maximum frequency"})," of the signal.\nIn other words, we must sample at least twice per cycle."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"NyquistTheorem",src:n(29062).A+"",width:"603",height:"504"})}),"\n",(0,a.jsx)(s.h3,{id:"examples-of-analog-sensors",children:"Examples of analog sensors"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"temperature sensor"}),"\n",(0,a.jsx)(s.li,{children:"potentiometer"}),"\n",(0,a.jsx)(s.li,{children:"photoresistor (what we will be using for this lab)"}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["A ",(0,a.jsx)(s.strong,{children:"photoresistor"})," (or photocell) is a sensor that measures the intensity of light around it. Its internal resistance varies depending on the light hitting its surface; therefore, the more light there is, the lower the resistance will be."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Photoresistor",src:n(17893).A+"",width:"266",height:"269"})}),"\n",(0,a.jsx)(s.h4,{id:"how-to-wire-a-photoresistor",children:"How to wire a photoresistor"}),"\n",(0,a.jsxs)(s.p,{children:["To wire a photoresistor, we need to connect one leg to ",(0,a.jsx)(s.em,{children:"GND"})," and the other leg to a voltage divider. We remember from ",(0,a.jsx)(s.a,{href:"/docs/fils_en/01#voltage-divider",children:"Lab 01 - Hardware Introduction"})," that:"]}),"\n",(0,a.jsx)(s.span,{className:"katex-display",children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"V"}),(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"o"}),(0,a.jsx)(s.mi,{children:"u"}),(0,a.jsx)(s.mi,{children:"t"})]})]}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"V"}),(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"i"}),(0,a.jsx)(s.mi,{children:"n"})]})]}),(0,a.jsx)(s.mo,{children:"\u2217"}),(0,a.jsxs)(s.mfrac,{children:[(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"R"}),(0,a.jsx)(s.mn,{children:"2"})]}),(0,a.jsxs)(s.mrow,{children:[(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"R"}),(0,a.jsx)(s.mn,{children:"1"})]}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"R"}),(0,a.jsx)(s.mn,{children:"2"})]})]})]}),(0,a.jsx)(s.mo,{separator:"true",children:";"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"V_{out} = V_{in} * \\frac{R_{2}}{R_{1} + R_{2}};"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.2806em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.2222em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsxs)(s.span,{className:"mord mtight",children:[(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"o"}),(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"u"}),(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"t"})]})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3117em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.2222em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"in"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"\u2217"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"2.1963em",verticalAlign:"-0.836em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,a.jsx)(s.span,{className:"mfrac",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"1.3603em"},children:[(0,a.jsxs)(s.span,{style:{top:"-2.314em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0077em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"1"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0077em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"2"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})]}),(0,a.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,a.jsxs)(s.span,{style:{top:"-3.677em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord",children:(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0077em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"2"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.836em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mclose nulldelimiter"})]}),(0,a.jsx)(s.span,{className:"mpunct",children:";"})]})]})]})}),"\n",(0,a.jsx)(s.p,{children:"In our case:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"V"}),(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"o"}),(0,a.jsx)(s.mi,{children:"u"}),(0,a.jsx)(s.mi,{children:"t"})]})]})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"V_{out}"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.2806em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.2222em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsxs)(s.span,{className:"mord mtight",children:[(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"o"}),(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"u"}),(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"t"})]})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})})]})," will be the voltage at the ADC pin on the MCU"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"V"}),(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"i"}),(0,a.jsx)(s.mi,{children:"n"})]})]})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"V_{in}"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"},children:"V"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3117em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.2222em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"in"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})})]})," will be the voltage at the from the GPIO pin the photoresistor is tied to"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"R"}),(0,a.jsx)(s.mn,{children:"1"})]})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"R_{1}"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0077em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"1"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})})]})," is the variable resistance of the photoresistor"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"R"}),(0,a.jsx)(s.mn,{children:"2"})]})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"R_{2}"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0077em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:(0,a.jsx)(s.span,{className:"mord mtight",children:"2"})})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]})]})})]})," is a resistance compatible with our photoresistor (in our case, 10k ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{mathvariant:"normal",children:"\u03a9"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\Omega"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord",children:"\u03a9"})]})})]}),")"]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"This way, the ADC pin measures the photoresistor's resistance, without the risk of a short-circuit."}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"PhotoresistorWiring",src:n(87468).A+"",width:"431",height:"285"})}),"\n",(0,a.jsx)(s.h3,{id:"adc-in-embassy-rs",children:"ADC in Embassy-rs"}),"\n",(0,a.jsxs)(s.p,{children:["On the RP2040, ADC uses an interrupt called ",(0,a.jsx)(s.code,{children:"ADC_IRQ_FIFO"})," to signal whenever a new sample has been added to the ADCs' FIFO. This new sample will be stored inside a FIFO. In the Embassy library, this interrupt is already implemented, so all we need to do is bind it and use it in our ADC variable."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"// Bind the `ADC_IRQ_FIFO` interrupt to the Embassy's ADC handler\nbind_interrupts!(struct Irqs {\n    ADC_IRQ_FIFO => InterruptHandler;\n});\n\n// ---- fn main() ----\n\n// Initialize peripherals\nlet peripherals = embassy_rp::init(Default::default());\n\n// Create ADC driver\nlet mut adc = Adc::new(peripherals.ADC, Irqs, Config::default());\n"})}),"\n",(0,a.jsxs)(s.admonition,{type:"warning",children:[(0,a.jsxs)(s.p,{children:["If we are using PWM and ADC in the same code, we will have two different ",(0,a.jsx)(s.code,{children:"Config"})," imports with the same name. In order to avoid compilation errors, we need to separate the PWM config import from the ADC one. To do this, we can import the two ",(0,a.jsx)(s.code,{children:"Config"}),"s with different names."]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"use embassy_rp::adc::Config as ConfigAdc; // ADC config\n\n// ---- fn main() ----\nlet mut adc = Adc::new(peripherals.ADC, Irqs, ConfigAdc::default());\n"})})]}),"\n",(0,a.jsxs)(s.p,{children:["Now, we need to initialize the ADC pin we will be using. The Raspberry Pi Pico has 3 pins that support ADC: ",(0,a.jsx)(s.code,{children:"ADC0"}),", ",(0,a.jsx)(s.code,{children:"ADC1"}),", and ",(0,a.jsx)(s.code,{children:"ADC2"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"// Initialize ADC pin\nlet mut adc_pin = Channel::new_pin(peripherals.PIN_X, Pull::None); // where X should be replaced with a pin number\n"})}),"\n",(0,a.jsx)(s.p,{children:"Once we have the ADC and pin set up, we can start reading values from the pin."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:'let level = adc.read(&mut adc_pin).await.unwrap(); // read a value from the pin\ninfo!("Light sensor reading: {}", level); // print the value over serial\nTimer::after_secs(1).await; // wait a bit before reading and printing another value\n'})}),"\n",(0,a.jsx)(s.h2,{id:"exercises",children:"Exercises"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Connect an LED to pin GP2, a photo-resistor to ADC0 and an RGB LED to pins GP1, GP3, GP4. Use ",(0,a.jsx)(s.a,{href:"https://www.kicad.org/",children:"KiCad"})," to draw the schematics. (",(0,a.jsx)(s.strong,{children:"1p"}),")"]}),"\n",(0,a.jsxs)(s.li,{children:["Take a look at ",(0,a.jsx)(s.code,{children:"lab04_ex2"})," in the lab skeleton. It is a working example of lighting an LED using PWM at 50% intensity. The LED in the example is connected to GP0.","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Modify the provided example to light the LED of ",(0,a.jsx)(s.em,{children:"your circuit"})," to 25% intensity. (",(0,a.jsx)(s.strong,{children:"1p"}),")"]}),"\n",(0,a.jsxs)(s.li,{children:["Increase the LED's intensity by 10% every second, until it reaches max intensity, when it stops. (",(0,a.jsx)(s.strong,{children:"1p"}),")"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["Read the value of the photo-resistor and print it to the console. (",(0,a.jsx)(s.strong,{children:"2p"}),")"]}),"\n"]}),"\n",(0,a.jsxs)(s.admonition,{type:"info",children:[(0,a.jsxs)(s.p,{children:["To see the console with messages from the Pico, use the flash command with an extra ",(0,a.jsx)(s.code,{children:"-s"})," parameter."]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"elf2uf2-rs -s -d /target/thumbv6m-none-eabi/debug/<crate_name>\n"})})]}),"\n",(0,a.jsxs)(s.admonition,{type:"info",children:[(0,a.jsx)(s.p,{children:"To be able to print messages to the console, we need to send messages over a simulated serial port to the computer. For this, we will use the USB driver provided by Embassy."}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:'use embassy_rp::usb::{Driver, InterruptHandler};\nuse embassy_rp::{bind_interrupts, peripherals::USB};\nuse log::info;\n\n// Use for the serial over USB driver\nbind_interrupts!(struct Irqs {\n    USBCTRL_IRQ => InterruptHandler<USB>;\n});\n\n\n// The task used by the serial port driver \n// over USB\n#[embassy_executor::task]\nasync fn logger_task(driver: Driver<\'static, USB>) {\n    embassy_usb_logger::run!(1024, log::LevelFilter::Info, driver);\n}\n\n#[embassy_executor::main]\nasync fn main(spawner: Spawner) {\n    let peripherals = embassy_rp::init(Default::default());\n\n    // Start the serial port over USB driver\n    let driver = Driver::new(peripherals.USB, Irqs);\n    spawner.spawn(logger_task(driver)).unwrap();\n\n    // ...\n\n    info!("message");\n}\n\n'})})]}),"\n",(0,a.jsx)(s.admonition,{type:"warning",children:(0,a.jsxs)(s.p,{children:["Notice that the USB driver also uses an ",(0,a.jsx)(s.code,{children:"InterruptHandler"})," import that could be confused with the ",(0,a.jsx)(s.code,{children:"InterruptHandler"})," used by ADC. Make sure to use different naming conventions for each one, as described in the warning ",(0,a.jsx)(s.a,{href:"#adc-in-embassy-rs",children:"here"}),"."]})}),"\n",(0,a.jsxs)(s.ol,{start:"4",children:["\n",(0,a.jsxs)(s.li,{children:["Depending on the value read from the photo-resistor, brighten or dim the led. The led should shine brighter when there is ",(0,a.jsx)(s.em,{children:"less"})," light in the room. (",(0,a.jsx)(s.strong,{children:"2p"}),")"]}),"\n"]}),"\n",(0,a.jsx)(s.admonition,{type:"tip",children:(0,a.jsx)(s.p,{children:"Use the serial console to debug your program!"})}),"\n",(0,a.jsxs)(s.ol,{start:"5",children:["\n",(0,a.jsxs)(s.li,{children:["Make the RGB LED switch from red -> yellow -> blue every time the switch A is pressed. (",(0,a.jsx)(s.strong,{children:"2p"}),")"]}),"\n"]}),"\n",(0,a.jsx)(s.admonition,{type:"note",children:(0,a.jsxs)(s.p,{children:["The reason why we ",(0,a.jsx)(s.strong,{children:"can't"})," use GP1, GP2 and GP3 for the RGB LED, for example, is because GP2 and GP3 are both on PWM channel 1, therefore we can't independently control them with PWM."]})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Colors",src:n(88046).A+"",width:"354",height:"309"})}),"\n",(0,a.jsxs)(s.ol,{start:"6",children:["\n",(0,a.jsxs)(s.li,{children:["Using the ",(0,a.jsx)(s.code,{children:"SysTick"})," interrupt in ",(0,a.jsx)(s.em,{children:"bare metal"}),", make the led blink at a 100ms delay. (",(0,a.jsx)(s.strong,{children:"1p"}),")"]}),"\n"]}),"\n",(0,a.jsxs)(s.admonition,{type:"tip",children:[(0,a.jsxs)(s.p,{children:["Setting up the ",(0,a.jsx)(s.code,{children:"SysTick"})," counter:"]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"const SYST_RVR: *mut u32 = 0xe000_e014 as *mut u32;\nconst SYST_CVR: *mut u32 = 0xe000_e018 as *mut u32;\nconst SYST_CSR: *mut u32 = 0xe000_e010 as *mut u32;\n\n// fire systick every 5 seconds\nlet interval: u32 = 5_000_000;\nunsafe {\n    write_volatile(SYST_RVR, interval);\n    write_volatile(SYST_CVR, 0);\n\n    // set fields `ENABLE` and `TICKINT`\n    write_volatile(SYST_CSR, 0b011);\n    // we need to write the whole register, single bit modifications is not possible with the SYST_CSR register\n}\n"})}),(0,a.jsxs)(s.p,{children:["Registering the ",(0,a.jsx)(s.code,{children:"SysTick"})," handler:"]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"#[exception]\nunsafe fn SysTick() { \n    /* systick fired */ \n}\n"})}),(0,a.jsxs)(s.p,{children:["To blink the led in bare metal, use the code provided in ",(0,a.jsx)(s.a,{href:"/docs/fils_en/lab/03",children:"Lab 03 - Exceptions & Interrupts"}),"."]})]}),"\n",(0,a.jsxs)(s.admonition,{type:"info",children:[(0,a.jsxs)(s.p,{children:["To safely share a bool value globally to keep track of the LED status, we need to use an ",(0,a.jsx)(s.a,{href:"https://doc.rust-lang.org/std/sync/atomic/struct.AtomicBool.html",children:(0,a.jsx)(s.code,{children:"AtomicBool"})}),". This requires less code than using a normal ",(0,a.jsx)(s.code,{children:"bool"})," and a ",(0,a.jsx)(s.code,{children:"Mutex"}),"."]}),(0,a.jsxs)(s.p,{children:["Creating a new static ",(0,a.jsx)(s.code,{children:"AtomicBool"}),":"]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"// imports \nuse core::sync::atomic::{AtomicBool, Ordering};\n\nstatic atomic_bool: AtomicBool = AtomicBool::new(false);\n"})}),(0,a.jsxs)(s.p,{children:["Reading the value of an ",(0,a.jsx)(s.code,{children:"AtomicBool"}),":"]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"let atomic_bool_value = atomic_bool.load(Ordering::Relaxed);\n"})}),(0,a.jsxs)(s.p,{children:["Writing the value of an ",(0,a.jsx)(s.code,{children:"AtomicBool"}),":"]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"atomic_bool.store(true, Ordering::Relaxed);\n"})})]})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},78600:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/alarm-9123adf62510936424b4888da274f82c.svg"},51247:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/analog_signal-ee6e6499b17b16b8767bfa035eef7f27.png"},76195:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/clock_signal-49541bcc52f09f14d1e19e36915c823f.png"},88046:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/colors-5c3fa50830d1fe6674ca97582baefa2a.png"},35562:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/common_anode_common_cathode-55cd44f9c6fc1b24f672e6413daff3a7.png"},32759:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/counter-f510d875d964f5993ebfa39e196df625.svg"},82825:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/digital_signal-fb5afef385984f5a23322d339559c85d.png"},29:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/duty_cycle-1ff8d97f4bd060f866d5c6065da60c99.png"},29062:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/nyquist_theorem-436cb31254d8dc2736da55165cb16b26.png"},17893:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/photoresistor-93b2c60234e6e6ce1015f694e550fce1.png"},87468:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/photoresistor_wiring-fec82e46ceca20f9018410bce236b23e.png"},68991:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/pulse-width-modulation-signal-diagrams-average-e8f71f3620c486efcdefc7756a750c3b.png"},49185:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/pwm_led-ab77a3a86e59318f34cdadd308ea309f.gif"},94306:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/pwm_rp2040_example-25843139fb0e6b4d0cb5b1e385005a4b.png"},89290:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/pwm_rp2040_pins-7f62d3fd206da6dbc5db00501b92c370.png"},47171:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/rp_crystal-efcca4da8116b36900130ee21ac95135.png"},1175:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/sampling_values-44d287bb9a945455cd1168efe4352357.svg"},28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>r});var i=n(96540);const a={},t=i.createContext(a);function l(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);