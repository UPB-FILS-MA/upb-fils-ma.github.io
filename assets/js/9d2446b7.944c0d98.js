"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6553],{15208:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>c,frontMatter:()=>n,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"project/2024/rares.negrila/index","title":"Laser Piano","description":"A piano made using laser diodes and laser receivers.","source":"@site/versioned_docs/version-fils_en/project/2024/rares.negrila/index.md","sourceDirName":"project/2024/rares.negrila","slug":"/project/2024/rares.negrila/","permalink":"/docs/fils_en/project/2024/rares.negrila/","draft":false,"unlisted":false,"editUrl":"https://github.com/UPB-FILS-MA/upb-fils-ma.github.io/edit/main/versioned_docs/version-fils_en/project/2024/rares.negrila/index.md","tags":[],"version":"fils_en","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"CyberSim","permalink":"/docs/fils_en/project/2024/rares.ionescu3004/"},"next":{"title":"MeloLED","permalink":"/docs/fils_en/project/2024/raul_anton.jac/"}}');var r=s(74848),d=s(28453);const n={},a="Laser Piano",o={},h=[{value:"Description",id:"description",level:2},{value:"Motivation",id:"motivation",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Log",id:"log",level:2},{value:"Week 6 - 12 May",id:"week-6---12-may",level:3},{value:"Week 7 - 19 May",id:"week-7---19-may",level:3},{value:"Week 20 - 26 May",id:"week-20---26-may",level:3},{value:"Hardware",id:"hardware",level:2},{value:"Schematics",id:"schematics",level:3},{value:"Bill of Materials",id:"bill-of-materials",level:3},{value:"Software",id:"software",level:2},{value:"Links",id:"links",level:2}];function l(e){const t={a:"a",admonition:"admonition",br:"br",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"laser-piano",children:"Laser Piano"})}),"\n",(0,r.jsx)(t.p,{children:"A piano made using laser diodes and laser receivers."}),"\n",(0,r.jsxs)(t.admonition,{type:"info",children:[(0,r.jsx)(t.mdxAdmonitionTitle,{}),(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Author"}),": Negrila Rares ",(0,r.jsx)(t.br,{}),"\n",(0,r.jsx)(t.strong,{children:"GitHub Project Link"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/UPB-FILS-MA/project-NegrilaRares",children:"https://github.com/UPB-FILS-MA/project-NegrilaRares"})]})]}),"\n",(0,r.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,r.jsx)(t.p,{children:"A piano made using laser diodes and laser receivers."}),"\n",(0,r.jsx)(t.p,{children:"It uses a potentiometer with leds to adjust and show volume,\n3 separete switches with leds to displat change in octave\nand 7 laser diodes and laser receivers that act as the piano keys."}),"\n",(0,r.jsx)(t.p,{children:"The plan is to take the sound data from an sd card and give it to a dac that will give the analog output to a audio jack module the is connected to a portable speaker.\nIt uses an LM386 audio amplifier module and 2 RC low pass filters to keep the signal clear and to a reasonable level."}),"\n",(0,r.jsx)(t.h2,{id:"motivation",children:"Motivation"}),"\n",(0,r.jsx)(t.p,{children:"The reason I chose this project is because I took an interest in laser diodes\nand wanted to learn file reading/writing from an external memory device\nas well as understand the conversion of digital code into analog sound."}),"\n",(0,r.jsx)(t.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"architecture",src:s(26762).A+"",width:"1061",height:"345"})}),"\n",(0,r.jsx)(t.h2,{id:"log",children:"Log"}),"\n",(0,r.jsx)(t.h3,{id:"week-6---12-may",children:"Week 6 - 12 May"}),"\n",(0,r.jsx)(t.p,{children:"I encountered many problems with SD / microSD cards in embassy-rs."}),"\n",(0,r.jsx)(t.p,{children:"While the setup initially used matched the Raspberry Pi Pico embedded-hal example from rp-rs using the embedded-sdmmc-rs crate, it did not behave as expected. The SD card itself failed to be read in any way, shape, or form. Even when manually sending CMD0, CMD1, and CMD8 commands, the response was not within the expected parameters."}),"\n",(0,r.jsx)(t.p,{children:"In the end, I found a solution. I created a blocking::spi::SpiDevice using embassy_embedded_hal."}),"\n",(0,r.jsx)(t.p,{children:"For initialization, I had to give the program ownership over a phantom CS pin\u2014a CS pin that could not be used and would no longer need to be used in the case of microSDs."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"code_1",src:s(67493).A+"",width:"942",height:"178"})}),"\n",(0,r.jsx)(t.p,{children:"I opted for a normal SD card in the end, where I could still connect the second CS pin, given that the SD card module comes with 2 rows of pins."}),"\n",(0,r.jsx)(t.h3,{id:"week-7---19-may",children:"Week 7 - 19 May"}),"\n",(0,r.jsx)(t.p,{children:"After getting the SD card reader to work, I encountered my next challenge: data processing and the RAM limitations of the Raspberry Pi Pico."}),"\n",(0,r.jsx)(t.p,{children:"Since the files themselves did not have too large of a PCM, storing them temporarily was not an issue. However, giving the data to the DAC proved to be a challenge."}),"\n",(0,r.jsx)(t.p,{children:"For some reason, the while loop I was creating for processing did not accept any awaits or it would panic almost instantly. Additionally, giving the microcontroller too much to work on in too many iterations proved to be impossible."}),"\n",(0,r.jsx)(t.p,{children:"To address this, I had to cut the files from 16-bit WAV files to 8-bit. This made processing much easier because now I only had to give an empty byte (with the first 4 bits setting the fast write mode of the DAC and the last 4 bits being empty data for the 12-bit interface) and the data bytes taken from the SD card. With this approach, I managed to cut the iterations from approximately 57,600 to about 28,650, and data processing to about 25%."}),"\n",(0,r.jsx)(t.p,{children:"Despite these optimizations, the processing speed still proves to be insufficient. I see little solution to apply within my current limitations."}),"\n",(0,r.jsx)(t.p,{children:"The biggest downside of using 8-bit files is that the sound quality took a significant plunge."}),"\n",(0,r.jsx)(t.p,{children:"Now that I had my sound working, I needed to start working on clearing it up, as it was, at that time, an unintelligible mess."}),"\n",(0,r.jsx)(t.p,{children:"To improve the sound quality, I switched to a portable speaker rather than the one I used before, and I attached an audio jack module to connect it. This proved to be insufficient, so I employed some RC low-pass filters to make some final touches."}),"\n",(0,r.jsx)(t.p,{children:"While now there is still some static, it is nowhere near as bad as before.\nDespite the 8-bit sound quality, the sound can now be differentiated between keys."}),"\n",(0,r.jsx)(t.h3,{id:"week-20---26-may",children:"Week 20 - 26 May"}),"\n",(0,r.jsx)(t.p,{children:"The project ended up working perfectly on the breadboards as a prototype."}),"\n",(0,r.jsx)(t.p,{children:"Sadly after putting the final version together, soldering everything on some prototype pcbs and putting everything in a wooden casing, I have lost a lot of the sound quality due to interference from the solder of the pcb."}),"\n",(0,r.jsx)(t.p,{children:"Everything still functions ok."}),"\n",(0,r.jsx)(t.p,{children:"The sound leaves a bit more to be desired when compared to the breadboard version."}),"\n",(0,r.jsx)(t.p,{children:"This has been a lesson to me about analog waves and soldering, without experience, they don't go well together."}),"\n",(0,r.jsx)(t.h2,{id:"hardware",children:"Hardware"}),"\n",(0,r.jsx)(t.p,{children:"Using LEDs as settings indicators, buttons and a stereo potentiometer for octave and volume respectively."}),"\n",(0,r.jsx)(t.p,{children:"Seven laser diodes are placed at an angle to continuously shine on the laser receivers."}),"\n",(0,r.jsx)(t.p,{children:"An SD card reader is used with a 16GB SD card (the card has to use the W95 FAT32 (LBA) format)."}),"\n",(0,r.jsx)(t.p,{children:"A DAC is used for processing the data and an amplifier is used to keep the signal at a desirable level."}),"\n",(0,r.jsx)(t.p,{children:"Two RC low-pass filters are employed, each with 1780 k\u03a9 resistors."}),"\n",(0,r.jsx)(t.p,{children:"One filter uses a 0.1 \xb5F capacitor, while the other uses a 0.22 \xb5F capacitor."}),"\n",(0,r.jsx)(t.p,{children:"The amplifier is connected to the opposite port of the stereo potentiometer, and the speaker is connected to the output of the amplifier through an audio jack module."}),"\n",(0,r.jsx)(t.p,{children:"Full breadboard prototype:"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"hardware_on_breadboard",src:s(61228).A+"",width:"2048",height:"992"})}),"\n",(0,r.jsx)(t.p,{children:"Laser processing:"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"hardware_on_breadboard",src:s(64109).A+"",width:"2048",height:"1536"})}),"\n",(0,r.jsx)(t.p,{children:"Analog signal processing:"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"hardware_on_breadboard",src:s(32774).A+"",width:"2048",height:"1536"})}),"\n",(0,r.jsx)(t.h3,{id:"schematics",children:"Schematics"}),"\n",(0,r.jsx)(t.p,{children:"Some of the parts were either created by me as they did not have a publicly available schematic but most of the more detailed schemas for the modules used can be found in their datasheet."}),"\n",(0,r.jsx)(t.p,{children:"In this case I couldn't find the Laser Receiver Symbol, the SD card reader module, the LM386 module and the audio jack module with the portable speaker."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"schematics",src:s(14723).A+"",width:"1253",height:"846"})}),"\n",(0,r.jsx)(t.h3,{id:"bill-of-materials",children:"Bill of Materials"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Device"}),(0,r.jsx)(t.th,{children:"Usage"}),(0,r.jsx)(t.th,{children:"Price"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html",children:"Rapspberry Pi Pico W"})}),(0,r.jsx)(t.td,{children:"The microcontroller"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.optimusdigital.ro/en/raspberry-pi-boards/12394-raspberry-pi-pico-w.html",children:"35 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"13 * Led"}),(0,r.jsx)(t.td,{children:"This is used for displaying current settings"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"13 * 220 Ohm R"}),(0,r.jsx)(t.td,{children:"This is used to make sure the leds don't get fried"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"10 * 10 kOhm R"}),(0,r.jsx)(t.td,{children:"This is used to crate pull up and pull down resistors"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"3 * 1780 Ohm R"}),(0,r.jsx)(t.td,{children:"This is used for the RC low pass filters"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"7 * 0.1 uF Capacitor"}),(0,r.jsx)(t.td,{children:"This is used to debounce the signal from the laser receivers and for one of the low pass filters"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"1 * 0.22 uF Capacitor"}),(0,r.jsx)(t.td,{children:"This is used for one of the low pass filters"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"lots * cables"}),(0,r.jsx)(t.td,{children:"This is used to connect diffrent things on the breadboard/prototype pcb"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"10k Stereo Potentiometer"}),(0,r.jsx)(t.td,{children:"This is used for volume input"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.optimusdigital.ro/en/potentiometers/1886-10k-stereo-potentiometer.html",children:"2 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{children:["2 * ",(0,r.jsx)(t.a,{href:"https://www.diodes.com/assets/Datasheets/74HC595.pdf",children:"Shift Register"})]}),(0,r.jsx)(t.td,{children:"This is used for the output of the volume setting"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.optimusdigital.ro/en/others/2448-registru-de-deplasare-74hc595-dip-16.html",children:"2 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Laser Diode"}),(0,r.jsx)(t.td,{children:"This is used to generate a laser"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://ardushop.ro/ro/electronica/262-modul-dioda-laser-rou-5mw.html",children:"2.5 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{children:["7 * ",(0,r.jsx)(t.a,{href:"https://forum.arduino.cc/t/documents-about-laser-sensor-ds18b20/1090450/5",children:"ISO203"})]}),(0,r.jsx)(t.td,{children:"This is used to monitor for interference in the path of the laser"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.optimusdigital.ro/en/others/3289-laser-diode-receiver.html",children:"6.5 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"SD card reader module"}),(0,r.jsx)(t.td,{children:"This is used to read the data from an SD card"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.optimusdigital.ro/en/others/98-sd-card-reader.html?search_query=sd+card&results=530",children:"6 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://ww1.microchip.com/downloads/en/devicedoc/22039d.pdf",children:"DAC MCP4725"})}),(0,r.jsx)(t.td,{children:"This is used to transfrom the binary from the audio file data into an analog singal for the speaker"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.optimusdigital.ro/en/others/1327-dac-mcp4725-module-with-i2c-interface.html?search_query=dac&results=62",children:"25 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Portable Speaker"}),(0,r.jsx)(t.td,{children:"This is used to receive the analog signal through an audio jack module and create an appropriate sound"}),(0,r.jsx)(t.td,{children:"[-]"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.ti.com/lit/ds/symlink/lm386.pdf",children:"AMP LM386"})}),(0,r.jsx)(t.td,{children:"This is used amplify the analog singal"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://ardushop.ro/ro/electronica/241-modul-amplificator-audio-lm386.html",children:"6.5 RON"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Audio Jack Module"}),(0,r.jsx)(t.td,{children:"This is used amplify the analog singal"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://www.optimusdigital.ro/en/connectors/752-modul-jack-audio-stereo-de-35-mm.html?search_query=audio+jack+module&results=19",children:"5 RON"})})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"software",children:"Software"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Library"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Usage"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/rust-embedded-community/embedded-sdmmc-rs",children:"SD card Crate"})}),(0,r.jsx)(t.td,{children:"Crate for the SD card reader"}),(0,r.jsx)(t.td,{children:"Used for reading pcm from wav files"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/vgasparyan/mcp4725-rs",children:"MCP4725 Crate"})}),(0,r.jsx)(t.td,{children:"Crate for the MCP4725 DAC"}),(0,r.jsx)(t.td,{children:"Used to send the data received from the microsd card to the digital to analog converter"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/embassy-rs/embassy",children:"Framework used in project"})}),(0,r.jsx)(t.td,{children:"Rust framework for embedded programming"}),(0,r.jsx)(t.td,{children:"Used to program the behaviour of the raspberry pi pico and used to simplify certain concepts of embedded programming"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://docs.rs/log/latest/log/",children:"Log"})}),(0,r.jsx)(t.td,{children:"Rust Crate for data displaying"}),(0,r.jsx)(t.td,{children:"Used to display data throught the usb in the terminal of the computer when interacting with the device as a manufacturer"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://docs.embassy.dev/embassy-embedded-hal/git/default/index.html",children:"embassy-embedded-hal"})}),(0,r.jsx)(t.td,{children:"Collection of utilities to use embedded-hal and embedded-storage traits with Embassy"}),(0,r.jsx)(t.td,{children:"Used to solve some sd card problems"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://docs.rs/embassy-time/latest/embassy_time/",children:"embassy-time"})}),(0,r.jsx)(t.td,{children:"Timekeeping, delays and timeouts."}),(0,r.jsx)(t.td,{children:"Used to make time constraints and awaits."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://docs.rs/embassy-futures/latest/embassy_futures/",children:"embassy-futures"})}),(0,r.jsx)(t.td,{children:"Utilities for working with futures, compatible with no_std and not using alloc. Optimized for code size, ideal for embedded systems."}),(0,r.jsx)(t.td,{children:"Used to make await input actions."})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"links",children:"Links"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://youtu.be/h_y1y6eUvIY?si=NTLO8pDmCqerRG1a",children:"Laser Inspiration Video"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://www.amazon.com/M-WAVE-Controller-Bluetooth-Professional-Production/dp/B0B66T4DHK?th=1",children:"Piano General Design Inspiration"})}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,d.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},26762:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/Architecture-96f6e632b13a093d839794b2c66bb481.JPG"},14723:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/KiCad-b15476c3fb9d8952f93b9309a4c6e3d8.JPG"},67493:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/cs-40be85dcf4a5abd23ca0878bab9db3d4.JPG"},61228:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/hardware_1-39c4792ae4dadcfa7327e78701a5ad67.jpeg"},64109:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/hardware_2-3b3d9e5c388fc7ae135cbc4400beb072.jpeg"},32774:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/hardware_3-8519d06a56603708fae82a11842cc684.jpeg"},28453:(e,t,s)=>{s.d(t,{R:()=>n,x:()=>a});var i=s(96540);const r={},d=i.createContext(r);function n(e){const t=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:n(e.components),i.createElement(d.Provider,{value:t},e.children)}}}]);