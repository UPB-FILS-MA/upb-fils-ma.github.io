<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-lab/02/02" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">02 - Memory Mapped IO &amp; GPIO | Microprocessor Architecture</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://embedded-rust-101.wyliodrin.com/img/docusaurus-social-card.png"><meta data-rh="true" name="twitter:image" content="https://embedded-rust-101.wyliodrin.com/img/docusaurus-social-card.png"><meta data-rh="true" property="og:url" content="https://embedded-rust-101.wyliodrin.com/docs/lab/02"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="02 - Memory Mapped IO &amp; GPIO | Microprocessor Architecture"><meta data-rh="true" name="description" content="Bare metal MMIO, PAC access and embassy-rs"><meta data-rh="true" property="og:description" content="Bare metal MMIO, PAC access and embassy-rs"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://embedded-rust-101.wyliodrin.com/docs/lab/02"><link data-rh="true" rel="alternate" href="https://embedded-rust-101.wyliodrin.com/docs/lab/02" hreflang="en"><link data-rh="true" rel="alternate" href="https://embedded-rust-101.wyliodrin.com/docs/lab/02" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Microprocessor Architecture RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Microprocessor Architecture Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.037d2e5c.css">
<script src="/assets/js/runtime~main.dbb4c540.js" defer="defer"></script>
<script src="/assets/js/main.bfafd7aa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Microprocessor Architecture" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Microprocessor Architecture" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Microprocessor Architecture</b></a><a class="navbar__item navbar__link" href="/docs/category/lecture">Lecture</a><a class="navbar__item navbar__link" href="/docs/category/lab">Lab</a><a class="navbar__item navbar__link" href="/docs/project">Project</a><a class="navbar__item navbar__link" href="/docs/category/tutorials">Tutorials</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/UPB-FILS-MA/upb-fils-ma.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/welcome">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/lecture">Lecture</a><button aria-label="Expand sidebar category &#x27;Lecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/lab">Lab</a><button aria-label="Collapse sidebar category &#x27;Lab&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/00">00 - Rust</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/01">01 - Hardware Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/lab/02">02 - Memory Mapped IO &amp; GPIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/03">03 - Exceptions &amp; Interrupts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/04">04 - PWM &amp; ADC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/05">05 - Asynchronous Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/06">06 - Serial Peripheral Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/07">07 - Inter-Integrated Circuit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lab/08">08 - Wi-Fi</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/project">Project</a><button aria-label="Expand sidebar category &#x27;Project&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/lab"><span itemprop="name">Lab</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">02 - Memory Mapped IO &amp; GPIO</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>02 - Memory Mapped IO &amp; GPIO</h1>
<p>The purpose of this lab is to understand how to start developing in <a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">Rust</a> for the
RP2040 MCU. The lab presents three examples:</p>
<ul>
<li><strong>bare metal</strong> development - writing directly to registers, actually writing a driver</li>
<li><strong>platform access crate</strong> (PAC) - using an automatically generated crate from the MCUs SVD file, actually writing a driver, but with some kind of automation</li>
<li><strong>embassy-rs</strong> - using the Rust standard <a href="https://docs.rs/embedded-hal/latest/embedded_hal/" target="_blank" rel="noopener noreferrer"><code>embedded-hal</code></a> implemented by the <a href="https://embassy.dev/" target="_blank" rel="noopener noreferrer">Embassy-rs</a> framework.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The example of this lab is to blink an LED at a certain time interval.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<ol>
<li><strong>Raspberry Pi Ltd</strong>, <em><a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf" target="_blank" rel="noopener noreferrer">RP2040 Datasheet</a></em></li>
<li><strong>Raspberry Pi Ltd</strong>, <em><a href="https://datasheets.raspberrypi.com/pico/pico-datasheet.pdf" target="_blank" rel="noopener noreferrer">Raspberry Pi Pico Datasheet</a></em></li>
<li><strong>Raspberry Pi Ltd</strong>, <em><a href="https://datasheets.raspberrypi.com/picow/pico-w-datasheet.pdf" target="_blank" rel="noopener noreferrer">Raspberry Pi Pico W Datasheet</a></em></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-gpio">What is GPIO?<a href="#what-is-gpio" class="hash-link" aria-label="Direct link to What is GPIO?" title="Direct link to What is GPIO?">​</a></h2>
<p>General-Purpose Input/Output, or GPIO, is an essential part of embedded systems that serves as a vital conduit between microcontrollers and microprocessors and the outside world. A microcontroller or microprocessor&#x27;s group of pins that can each be set to operate as an input or an output is referred to as GPIO. The purpose of these pins is to interface external components, including actuators, displays, sensors, and other devices, so that the embedded system may communicate with its surroundings. Standardised communication protocols like SPI, I2C, PCM, PWM, and serial communication may be directly supported by some GPIO pins. There are two varieties of GPIO pins: digital and analog.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-gpio-pins">Configuring GPIO Pins<a href="#configuring-gpio-pins" class="hash-link" aria-label="Direct link to Configuring GPIO Pins" title="Direct link to Configuring GPIO Pins">​</a></h2>
<p>GPIO pins can be used as outputs (LEDs, motors, buzzers) or as inputs (buttons, sensors).</p>
<p>The R02040 has three peripherals that control the GPIO pins:</p>
<ol>
<li><em>Pads</em> - control the actual physical pin or pad that the processor has outside. This control the electrical parameters, like maximum current or pull up and pull down resistors</li>
<li><em>IO Bank0</em> - connects and multiplexes the peripheral&#x27;s pins to the output pads. Several peripherals use the same output pad to communicate with the exterior. For example, in the image below, <code>GPIO0</code> can be used either for:<!-- -->
<ul>
<li><code>SIO</code> - the <code>GPIO</code> function</li>
<li><code>SPI_RX</code> - the receive pin for the <code>SPI</code> peripheral</li>
<li><code>I2C0_SDA</code> - the data pin for the <code>I2C0</code> peripheral</li>
<li><code>UART0_TX</code> - the transmit pin for the <code>UART0</code> (serial port 0) peripheral</li>
</ul>
</li>
<li><em>SIO</em> - that controls the interior MCU&#x27;s pins. This is the peripheral that developers use to read and write the value of the pins.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pico Pinout" src="/assets/images/pico-pinout-dd1099dbad1bed40f855431699089dc6.svg" width="842" height="595" class="img_ev3q"></p>
<p>Every pin of the MCU can perform multiple functions. Several peripherals need to use input and output pins.
It is the role of the <em>IO Bank0</em> to multiplex and connect the peripherals to the pins.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="IO Bank0" src="/assets/images/gpio_mux-e4a348a45def684b56fdace777269f64.png" width="1574" height="1114" class="img_ev3q"></p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hardware-access">Hardware access<a href="#hardware-access" class="hash-link" aria-label="Direct link to Hardware access" title="Direct link to Hardware access">​</a></h2>
<p>There are 3 different ways in which the hardware the Raspberry Pi Pico can be used:</p>
<ol>
<li>Embassy-rs framework, with the Embedded HAL implementation</li>
<li>Platform Access Crate (PAC)</li>
<li>Bare metal</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="embedded-hal-implementation">Embedded HAL Implementation<a href="#embedded-hal-implementation" class="hash-link" aria-label="Direct link to Embedded HAL Implementation" title="Direct link to Embedded HAL Implementation">​</a></h2>
<p>The bare metal and PAC require a lot of time and effort to develop applications.</p>
<p>The Rust <a href="https://www.rust-lang.org/governance/wgs/embedded" target="_blank" rel="noopener noreferrer">Embedded devices Working Group</a> has designed
a  set of standard traits (interfaces) for interacting with an MCU. This is called the <strong>Embedded Hardware Abstraction Layer</strong>, or shortly Embedded HAL. The main purpose is to define a common hardware interface that
frameworks, libraries and operating systems can build upon. Regardless of what MCUs the device is using, the upper level software should be as portable as possible.</p>
<p>There are several crates and frameworks that implement the Embedded HAL traits for the RP2040 MCU.</p>
<ul>
<li><a href="https://docs.rs/rp2040-hal/latest/rp2040_hal/" target="_blank" rel="noopener noreferrer">rp2040_hal</a> crate, implements just the embedded HAL traits, it is <em>the bare minimum</em> for developing RP2040 applications</li>
<li><a href="https://docs.embassy.dev/embassy-rp/git/rp2040/index.html" target="_blank" rel="noopener noreferrer">embassy-rp</a> crate implements the Embedded HAL for RP2040 that is used with the <a href="https://embassy.dev/" target="_blank" rel="noopener noreferrer">embassy-rs</a> framework</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="embassy-rs-framework">Embassy-rs framework<a href="#embassy-rs-framework" class="hash-link" aria-label="Direct link to Embassy-rs framework" title="Direct link to Embassy-rs framework">​</a></h3>
<p><a href="https://embassy.dev/" target="_blank" rel="noopener noreferrer">Embassy-rs</a> is a full fledged embedded framework for Rust embedded development.
Besides the implementation of the embedded HAL for different MCUs (RP2040 included), embassy-rs provides
several functions like timers, BLE and network communication.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Rust EMbedded Stack" src="/assets/images/rust_embedded_stack-8b3f636797a4c516d4202359f33d0143.svg" width="451" height="291" class="img_ev3q"></p></div>
<p>The crates used by Embassy-rs and their mapping are shown in the table bellow.</p>
<table><thead><tr><th>Crate</th><th>Position</th></tr></thead><tbody><tr><td><a href="https://docs.embassy.dev/embassy-executor/git/cortex-m/index.html" target="_blank" rel="noopener noreferrer"><code>embassy-executor</code></a></td><td>Framework</td></tr><tr><td><a href="https://docs.rs/smoltcp/latest/smoltcp/" target="_blank" rel="noopener noreferrer"><code>smoltcp</code></a>, <a href="https://docs.rs/defmt/latest/defmt/" target="_blank" rel="noopener noreferrer"><code>defmt</code></a></td><td>Libraries</td></tr><tr><td><a href="https://docs.embassy.dev/embassy-net/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>embassy-net</code></a>, <a href="https://docs.embassy.dev/embassy-time/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>embassy-time</code></a>, <a href="https://docs.embassy.dev/embassy-usb/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>embassy-usb</code></a>, <a href="https://docs.embassy.dev/embassy-usb-logger/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>embassy-usb-logger</code></a></td><td>Framework Driver</td></tr><tr><td><a href="https://docs.embassy.dev/embassy-usb-driver/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>embassy-usb-driver</code></a>, <a href="https://docs.embassy.dev/embassy-time-driver/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>embassy-time-driver</code></a></td><td>Embassy HAL (API)</td></tr><tr><td><a href="https://docs.embassy.dev/cyw43/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>cyw43</code></a>, <a href="https://docs.embassy.dev/cyw43-pio/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>cyw43-pio</code></a></td><td>Driver (WiFi)</td></tr><tr><td><a href="https://docs.rs/embedded-hal/latest/embedded_hal/" target="_blank" rel="noopener noreferrer"><code>embedded-hal</code></a>, <a href="https://docs.rs/embedded-hal-async/latest/embedded_hal_async/" target="_blank" rel="noopener noreferrer"><code>embedded-hal-async</code></a></td><td><strong>Rust Embedded HAL (Standard)</strong></td></tr><tr><td><a href="https://docs.embassy.dev/embassy-rp/git/rp2040/index.html" target="_blank" rel="noopener noreferrer"><code>embassy_rp</code></a></td><td>HAL Implementation</td></tr><tr><td><a href="https://docs.rs/cortex-m/latest/cortex_m/" target="_blank" rel="noopener noreferrer"><code>cortex-m</code></a>, <a href="https://docs.rs/cortex-m-rt/latest/cortex_m_rt/" target="_blank" rel="noopener noreferrer"><code>cortex-m-rt</code></a></td><td>μ-architecture crates</td></tr><tr><td><a href="https://docs.embassy.dev/rp-pac/git/default/index.html" target="_blank" rel="noopener noreferrer"><code>rp_pac</code></a></td><td>Platform Access Crate</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The name <em>Embassy-rs</em> is derived form <strong>Emb</strong>edded <strong>Asy</strong>nchronous Rust.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="entry">Entry<a href="#entry" class="hash-link" aria-label="Direct link to Entry" title="Direct link to Entry">​</a></h3>
<p>Embassy-rs is a framework built on top of <code>cortex-m-rt</code> and provides its own method of defining
the entrypoint and bootloader.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">embassy_executor</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Spawner</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[embassy_executor::main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_spawner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Spawner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> peripherals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">embassy_rp</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>embassy_rp::init</code> function takes care of the peripheral initialization so that developers can jump
right in and use them.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Embassy-rs is designed to work in an asynchronous way and this is why the <code>main</code> function is defined as <code>async</code>. For the time being, just take it as a must and ignore it.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-gpio-output">Configure GPIO Output<a href="#configure-gpio-output" class="hash-link" aria-label="Direct link to Configure GPIO Output" title="Direct link to Configure GPIO Output">​</a></h3>
<p>Embassy-rs provides one single function that returns the GPIO <code>Output</code> pin and hides the configuration
details from developers.</p>
<p>The <code>pin</code> variable implements the embadded HAL <a href="https://docs.rs/embedded-hal/latest/embedded_hal/digital/trait.OutputPin.html" target="_blank" rel="noopener noreferrer"><code>OutputPin</code></a> trait.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">gpio</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">Level</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Output</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// initialize PIN_n (replace n with a number) and set its</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// default value to LOW (0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> pin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Output</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peripherals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token class-name">PIN_n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Level</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Low</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the pin value to HIGH (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_high</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the pin value to LOW (0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_low</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>While the device initialization is specific to every hardware device (the example uses the
<code>embassy_rp</code> crate that is for RP2040), the pin initialization and usage is portable. It
uses the same code, regardless of the MCU used.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-gpio-input">Configure GPIO Input<a href="#configure-gpio-input" class="hash-link" aria-label="Direct link to Configure GPIO Input" title="Direct link to Configure GPIO Input">​</a></h3>
<p>Using a pin as input is very similar to using it as output.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">gpio</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">Input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Pull</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Input</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peripherals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token class-name">PIN_n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Pull</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Up</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> pin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_high</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Do something if the pin value is HIGH (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Do something if the pin value if LOW (0)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>For a correct use of the buttons, use pull-up, pull-down resistors depending on the mode of operation of the button. Check <a href="https://embedded-rust-101.wyliodrin.com/docs/lab/01#buttons" target="_blank" rel="noopener noreferrer">01 - Hardware Introduction</a></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="waiting">Waiting<a href="#waiting" class="hash-link" aria-label="Direct link to Waiting" title="Direct link to Waiting">​</a></h3>
<p>Embassy-rs provides support for suspending the execution of the software for an amount of time. It uses
the <a href="https://docs.rs/embassy-time/0.3.0/embassy_time/struct.Timer.html" target="_blank" rel="noopener noreferrer"><code>Timer</code></a> structure from the
<a href="https://docs.rs/embassy-time/latest/embassy_time/" target="_blank" rel="noopener noreferrer"><code>embassy_time</code></a> crate.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// suspend the execution for a period of time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">embassy_time</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Timer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Timer</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">after_secs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If the MCU provides timers, the Embassy framework will use them to suspend the software. This is very efficient.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="platform-access-crate-pac">Platform Access Crate (PAC)<a href="#platform-access-crate-pac" class="hash-link" aria-label="Direct link to Platform Access Crate (PAC)" title="Direct link to Platform Access Crate (PAC)">​</a></h2>
<p>A mid level way of developing in Rust for MCUs are the <em>platform access crates</em>
(PAC). These crates are automatically generated from the <em>System View Description</em> (SVD) files.</p>
<p>Using <a href="https://docs.rs/svd2rust/latest/svd2rust/" target="_blank" rel="noopener noreferrer">rust2svd</a>, developers can automatically generate
a crate that provides access functions to the MCUs registers. This provides a significant improvement,
as developers do not have to write manually the register addresses.</p>
<p>One of the PAC crates for the RP2040 MCU is <a href="https://docs.rs/rp2040-pac/latest/rp2040_pac/" target="_blank" rel="noopener noreferrer">rp2040-pac</a>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The PAC crate does not provide any means of initializing the MCU, so the entry point is still
defined by the <code>cortex-m-rt</code> crate, just as it is for bare metal. Bare metal will be discussed later in the lab.</p><p>Similarly, the PAC crate does not provide any <code>sleep</code> function.</p><p>This section presents only the differences between bare metal and PAC. The PAC mode of writing
embedded software is very similar to bare metal, just that register access is made easier.</p></div></div>
<p>The RP2040 (ARM Cortex-M0+) MCU uses <em>Memory Mapped Input Output</em> (MMIO). This means that the peripheral&#x27;s registers
are mapped into the address space (in normal words, in the memory). Reading and writing data from and to these registers
is done by memory reads and writes.</p>
<p>Blinking an LED in PAC or bare metal programming means following these steps:</p>
<ol>
<li>Ask the rust compiler not to use the <code>std</code> library, as it depends on the operating system</li>
<li>Write a <code>main</code> function and instruct the MCU to call it at startup (reset)</li>
<li>Configure the Single Cycle IO (SIO) peripheral to set a pin as output</li>
<li>Enable the <em>IO Bank0</em> peripheral of the RP2040</li>
<li>Configure the <em>IO Bank0</em> peripheral so that it sets a certain pin as output</li>
<li>Toggle the pin&#x27;s value through the <em>SIO</em>&#x27;s registers</li>
<li>Wait for an amount of time</li>
<li>Loop through steps 6 and 7</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-std">no-std<a href="#no-std" class="hash-link" aria-label="Direct link to no-std" title="Direct link to no-std">​</a></h3>
<p>As the code written runs on an MCU without any framework or operating system,
the Rust compiler cannot rely on the <code>std</code> library. The two macros directives
ask the compiler not to link the <code>std</code> library and not to expect <code>main</code>
function.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#![no_main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#![no_std]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The bare metal code has to start with these two directives.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bootloader">Bootloader<a href="#bootloader" class="hash-link" aria-label="Direct link to Bootloader" title="Direct link to Bootloader">​</a></h3>
<p>The RP2040 has a piece of software written in an internal ROM memory that is loaded
when the MCU boots. This looks at the first 256 bytes of the Flash memory
to understand how it needs to start the MCU.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>While the ROM bootloader is rather small, its functionality is very similar to the PC&#x27;s BIOS
boot sequence.</p></div></div>
<p>The RP2040&#x27;s datasheet explains the boot process. This is not very straight forward, and writing this
information requires a digital signature. The <code>rp2040-boot</code> crate provides the bootloader information
for booting with the <code>cortex-m-rt</code> crate.</p>
<p>Adding the following code to the Rust includes the bootloader.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[link_section = </span><span class="token attribute attr-name string" style="color:#e3116c">&quot;.boot_loader&quot;</span><span class="token attribute attr-name" style="color:#00a4db">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[used]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BOOT_LOADER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">rp2040_boot2</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token constant" style="color:#36acaa">BOOT_LOADER_W25Q080</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="entry-1">Entry<a href="#entry-1" class="hash-link" aria-label="Direct link to Entry" title="Direct link to Entry">​</a></h3>
<p>For this lab, we will use the <code>cortex-m-rt</code> crate. As the starting code for an MCU is usually processor
and vendor dependent, this crate allows developers to get started a little faster. It implements the bare minimum
initialization code and provides a macro called <code>entry</code> that developers can use to select the startup (main)
function.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The <code>entry</code> macro is used by Embassy through the <code>embassy_executor::main</code> macro that sets the <code>main</code> function as the startup point and defines the correct bootloader.</p></div></div>
<p>When an error occurs, Rust calls the <code>panic</code> function. When using the <code>std</code> library, the <code>panic</code> function is
already defined. It prints the error and usually unwinds the stack. When using <code>core</code>, it is the developer&#x27;s
job to define a <code>panic</code> function. In the case of bare metal development, the simplest <code>panic</code> function is
one that loops indefinitely, preventing the MCU form executing code.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">core</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">panic</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">PanicInfo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cortex_m_rt</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">entry</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// the `entry` macro sets up this function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// as the function that the MCU calls at</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// startup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[entry]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// the `main` function is not allows to return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// rust uses panics when an error occurs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// as this is bare metal, we have to define</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// the panic function that rust calls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[panic_handler]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_info</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">PanicInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// if an error occurs, we simply loop around</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// to prevent the MCU from executing </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// anything</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>In PAC or bare metal mode, the MCU does not run any framework or operating system, it just runs the developers bare metal code. This is why <code>main</code> function is not allowed to return, it loops forever. There is no system to which the function
could return control.</p></div></div>
<p>One of the first lines of the <code>main</code> function is getting a reference to all the
peripherals.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">rp2040_pac</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Peripherals</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[entry]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// get a reference to all the peripherals</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> peripherals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Peripherals</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">take</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">loop</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>In Embassy, the <code>main</code> function does not have to loop indefinitely, it is allowed to return, as it runs within the embassy-rs framework.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-sio">Configuring the SIO<a href="#configuring-the-sio" class="hash-link" aria-label="Direct link to Configuring the SIO" title="Direct link to Configuring the SIO">​</a></h3>
<p>In bare metal and PAC modes, developers have to manually initialize the <em>IO Bank0</em> and <em>SIO</em> peripherals.</p>
<p>The GPIO pins are configured using the MCU&#x27;s SIO registers. Each pin is configured by setting or clearing the corresponding
bit of several registers. Below is a table with the memory addresses of the SIO registers.</p>
<p>The PAC crate provides the <code>SIO</code> peripheral, which in turn provides a function for
each one of its registers. It fully hides the actual address of the registers.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="SIO Registers" src="/assets/images/sio_registers-55b3871fa9802e3f73ad39aa825e6be0.png" width="1564" height="826" class="img_ev3q"></p></div>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> sio </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> peripherals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SIO</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the `pin` pin as output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">gpio_oe_set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">w</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the `pin` to value `0`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">gpio_out_clr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">w</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the `pin` to value `1`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">gpio_out_set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">w</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-io-bank0">Configuring the IO Bank0<a href="#configuring-the-io-bank0" class="hash-link" aria-label="Direct link to Configuring the IO Bank0" title="Direct link to Configuring the IO Bank0">​</a></h3>
<p>GPIO pins can be configured for several functionalities, they can be used as GPIO pins or can also be used by certain peripherals, usually those that implement communication protocols. The RP2040&#x27;s <em>IO Bank0</em> peripherals performs this multiplexing.</p>
<p>The following table provides all the functions that each pin can have.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Pin Functions" src="/assets/images/pin_functions-fdb06f671cc97ac5762556279e0a7243.png" width="1348" height="1424" class="img_ev3q"></p></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enable-the-io-bank0">Enable the IO Bank0<a href="#enable-the-io-bank0" class="hash-link" aria-label="Direct link to Enable the IO Bank0" title="Direct link to Enable the IO Bank0">​</a></h4>
<p>When the RP2040 starts, the <em>IO Bank0</em> peripheral is disabled. To enable it, developers have to
use the <em>Reset</em>&#x27;s peripheral <code>RESET</code>  register.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Reset Registers" src="/assets/images/reset_registers-cf036134f671b7b67239f1c2042add6c.png" width="1518" height="342" class="img_ev3q"></p></div>
<p>The fields of the <code>RESET</code> register. To enable <em>IO Bank0</em>, developers have to write
a <code>0</code> in the <code>IO_BANK0</code> fields. By default, this field has the value <code>1</code>, which means that
`<em>IO Bank0</em> is disabled.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Reset Register" src="/assets/images/reset_reset-292eff7f7c95005256b91abeb913aff0.png" width="1514" height="1276" class="img_ev3q"></p></div>
<p>To verify that the <em>IO Bank0</em> peripheral has been enabled, developers have to check the field
<code>IO_BANK0</code> of the <code>RESET_DONE</code> register shown in the table bellow.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Reset Done Register" src="/assets/images/reset_reset_done-782724e7a569b4fc7cc8356a67983369.png" width="1512" height="748" class="img_ev3q"></p></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Developers might choose not to wait until the peripheral is enabled, but any writes to the peripheral&#x27;s
registers will most probably be ignored.</p></div></div>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> reset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> peripherals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RESETS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">modify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">r</span><span class="token closure-params punctuation" style="color:#393A34">,</span><span class="token closure-params"> w</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> reset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reset_done</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-gpio">Configure the GPIO<a href="#configure-the-gpio" class="hash-link" aria-label="Direct link to Configure the GPIO" title="Direct link to Configure the GPIO">​</a></h4>
<p>To connect the <em>SIO</em> peripheral to the output pins, developers have to modify the <code>GPIOx_CTRL</code> register.</p>
<p>The following table shows the fields of the <code>GPIOx_CTRL</code> register. The fields that is of interest is <code>FUNCSEL</code>.
Depending on the value written there, the <em>IO Bank0</em> will select a function or another. For this example,
we have to write value <code>5</code>.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="MCU Pins" src="/assets/images/gpio_ctrl_register-dc778eb8c02ba2d8e9ceba131d15843e.png" width="1444" height="1416" class="img_ev3q"></p></div>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> io_bank0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> peripherals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">IO_BANK0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// write the value 5 to the FUNCSEL field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Note: This actually writes the value 5 in FUNCSEL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       and 0s in all the other field. While this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       is fine for this example, usually a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       read, modify, write sequence should be used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">io_bank0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">gpio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">gpio_ctrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">w</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// the correct way of doing this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">io_bank0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">gpio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">gpio_ctrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// the PAC crate provides fucntions for all the </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// register&#x27;s fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">modify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">_</span><span class="token closure-params punctuation" style="color:#393A34">,</span><span class="token closure-params"> w</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">funcsel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-pad">Configuring the Pad<a href="#configuring-the-pad" class="hash-link" aria-label="Direct link to Configuring the Pad" title="Direct link to Configuring the Pad">​</a></h3>
<p>The Pad peripheral is responsible for the electrical setup of the pins. It can configure the
the maximum output current, input pull up or pull down resistor.</p>
<p>The following table shows the <em>Pads</em> peripheral registers. Each GPIO pin has a corresponding register.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Pad Registers" src="/assets/images/gpio_pad_registers-761ef6756b29b932f095910b03420f1e.png" width="1648" height="656" class="img_ev3q"></p></div>
<p>The following tables describe the <code>GPIOx</code> register. This register allows the configuration of several
electrical parameters.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Pad Pad Control 2" src="/assets/images/gpio_pad_ctrl_2-070ccc0536928281ee835e788cb53b9a.png" width="1652" height="352" class="img_ev3q"></p></div>
<div align="center"><p><img decoding="async" loading="lazy" alt="Pad Pad Control 1" src="/assets/images/gpio_pad_ctrl_1-d671eb0f38cbea49a9ce8bc89b76808e.png" width="1646" height="632" class="img_ev3q"></p></div>
<p>Looking at the default values, when the MCU starts, pins are configured:</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Output Enabled</td><td>Yes</td></tr><tr><td>Input Enabled</td><td>Yes</td></tr><tr><td>Maximum Output Current</td><td>4mA</td></tr><tr><td>Pull Input Resistor</td><td>Pull Down</td></tr><tr><td>Schmidt Trigger</td><td>Yes</td></tr><tr><td>Slew Rate</td><td>Slow</td></tr></tbody></table>
<p>For this lab, the default values are fine, this peripheral can be considered as being properly setup.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="wait-for-an-amount-of-time">Wait for an amount of time<a href="#wait-for-an-amount-of-time" class="hash-link" aria-label="Direct link to Wait for an amount of time" title="Direct link to Wait for an amount of time">​</a></h3>
<p>When using an operating system, developers usually have a function called <code>sleep</code> which asks the operating system
to suspend the process for a certain amount of time. In bare metal environment, with no framework or operating system,
this is not available. The MCU timers can be used for this, but the simplest (and most inefficient) of waiting is to
loop around while doing nothing. The Arm Cortex-M processors offer the <code>nop</code> instruction. This asks the processor
to do nothing.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// loops around 50000 times asking the processor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// to execute the `nop` instruction that does</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> _ </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// without this `asm` here, the compiler would optimize out the loop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">asm!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;nop&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>asm(&quot;nop&quot;)</code> is necessary, as otherwise the compiler optimizes out the empty loop.</p></div></div>
<p>The question is how fast does this execute. The RP2040 starts by default using an internal 12MHz clock.</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>t</mi><mrow><mi>n</mi><mi>o</mi><mi>p</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mn>12.000.000</mn></mfrac><mi>s</mi><mo>=</mo><mn>0.83</mn><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">t_{nop} = \frac{1}{12.000.000}s = 0.83ns</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">12.000.000</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.83</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span></span></span></span></span>
<p>The <code>loop</code> itself and the range (<code>0..50000</code>) calculation take another 4 - 5 MCU cycles. The actual wait time
of the example is:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>t</mi><mrow><mi>w</mi><mi>a</mi><mi>i</mi><mi>t</mi></mrow></msub><mo>=</mo><mn>5</mn><mo>∗</mo><mn>50000</mn><mo>∗</mo><mfrac><mn>1</mn><mn>12.000.000</mn></mfrac><mi>s</mi><mo>=</mo><mn>20.83</mn><mi>μ</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">t_{wait} = 5 * 50000 * \frac{1}{12.000.000}s = 20.83\mu s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span><span class="mord mathnormal mtight">ai</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">50000</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">12.000.000</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord">20.83</span><span class="mord mathnormal">μ</span><span class="mord mathnormal">s</span></span></span></span></span>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This approach is inefficient compared to the method used in Embassy.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bare-metal">Bare metal<a href="#bare-metal" class="hash-link" aria-label="Direct link to Bare metal" title="Direct link to Bare metal">​</a></h2>
<p>When using bare metal, developers interact directly with the hardware devices. They are responsible for all the
drivers and other components that they want to use. Mostly, bare metal development means <em>reading</em> and <em>writing</em> data
from and to the MCUs and peripheral registers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-sio-1">Configuring the SIO<a href="#configuring-the-sio-1" class="hash-link" aria-label="Direct link to Configuring the SIO" title="Direct link to Configuring the SIO">​</a></h3>
<p>The <em>SIO</em> peripheral has a base address, the address where its registers are mapped in the address space.</p>
<p>Each register has an offset, that represents the registers position (offset) relative to the <em>SIO</em>&#x27;s base address.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Computing the actual address of a register means adding the base address of the peripheral with the register&#x27;s offset.</p><p>e.g: <code>GPIO_OE</code>&#x27;s address is <code>0xd000_0000 + 0x020</code> =&gt; <code>0xd000_0020</code></p></div></div>
<div align="center"><p><img decoding="async" loading="lazy" alt="SIO Registers" src="/assets/images/sio_registers-55b3871fa9802e3f73ad39aa825e6be0.png" width="1564" height="826" class="img_ev3q"></p></div>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">core</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">ptr</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">write_volatile</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GPIO_OE_SET</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xd000_0024</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GPIO_OUT_SET</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xd000_0014</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GPIO_OUT_CLR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xd000_0018</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the `pin` pin as output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">write_volatile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">GPIO_OE_SET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the `pin` to value `0`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">write_volatile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">GPIO_OUT_CLR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// set the `pin` to value `1`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">write_volatile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">GPIO_OUT_SET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> pin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For a better understanding, please read subchapters 2.3.1.2 and 2.3.1.7 of the <a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf" target="_blank" rel="noopener noreferrer">datasheet</a>.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enable-the-io-bank">Enable the IO Bank<a href="#enable-the-io-bank" class="hash-link" aria-label="Direct link to Enable the IO Bank" title="Direct link to Enable the IO Bank">​</a></h4>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">RESET</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x4000_c000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CLR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x3000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">RESET_DONE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x4000_c008</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// clear bit `5` of the `RESET` register by</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// writing `1` on  bit `5` at address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// `RESET` + 0x3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">write_volatile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">RESET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CLR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// wait for the IO Bank0 to enable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">read_volatile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">RESET_DONE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>There is an interesting trick that the code above is using. Normally, the code modifies only the
bit 5 of the <code>RESET</code> register. To perform that, it should:</p><ol>
<li>read the register</li>
<li>modify the value read</li>
<li>write back the modified value</li>
</ol><p>The RP2040 MCU provides a trick that allows the instant modification. For each peripheral mapped at
address A, the MCU&#x27;s Bus maps three other <em>shadow</em> peripherals:</p><table><thead><tr><th>Name</th><th>Address</th><th>Behavior</th></tr></thead><tbody><tr><td><em>Peripheral_XOR</em></td><td>A+0x1000</td><td><code>REGISTER</code> = <code>REGISTER</code> ^ value (XORs the new value with the original register value)</td></tr><tr><td><em>Peripheral_SET</em></td><td>A+0x2000</td><td><code>REGISTER</code> = <code>REGISTER</code> | value (sets all the <code>1</code> bits of value in the original register)</td></tr><tr><td><em>Peripheral_CLR</em></td><td>A+0x3000</td><td><code>REGISTER</code> = <code>REGISTER</code> &amp; !value (for every <code>1</code> bit in the value, clears the corresponding bit in the original register)</td></tr></tbody></table></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-gpio-1">Configure the GPIO<a href="#configure-the-gpio-1" class="hash-link" aria-label="Direct link to Configure the GPIO" title="Direct link to Configure the GPIO">​</a></h4>
<p>To connect the <em>SIO</em> peripheral to the output pins, developers have to modify the <code>GPIOx_CTRL</code> register.</p>
<p>Each GPIO pin has its own control register, located at offset <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>40014000</mn><mi>h</mi><mo>+</mo><mn>4</mn><mo>+</mo><mn>8</mn><mo>∗</mo><mi>p</mi><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">40014000h + 4 + 8 * pin</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord">40014000</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">in</span></span></span></span>.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="MCU Pins" src="/assets/images/gpio_status_ctrl-6d9136c80e94b3841c05966e6e30226d.png" width="1454" height="260" class="img_ev3q"></p></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>For example, <code>GPIO25_CTRL</code>&#x27;s address is <code>0x40014000 + 4 + 8 * 25</code> = <code>0x400140CC</code>.
.</p><p>Pin 25 is connected to the onboard LED of the Raspberry Pi Pico.</p></div></div>
<p>The following table shows the fields of the <code>GPIOx_CTRL</code> register. The fields that is of interest is <code>FUNCSEL</code>.
Depending on the value written there, the <em>IO Bank0</em> will select a function or another. For this example,
we have to write value <code>5</code>.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="MCU Pins" src="/assets/images/gpio_ctrl_register-dc778eb8c02ba2d8e9ceba131d15843e.png" width="1444" height="1416" class="img_ev3q"></p></div>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GPIOX_CTRL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x4001_4004</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// compute the address of the GPIOx_CTRL register</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> gpio_ctrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">GPIOX_CTRL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">LED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// write the value 5 to the FUNCSEL field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Note: This actually writes the value 5 in FUNCSEL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       and 0s in all the other field. While this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       is fine for this example, usually a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       read, modify, write sequence should be used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">write_volatile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gpio_ctrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For a better understanding, please read subchapters 1.4.3, 2.1.12, 2.14, 2.19.1, 2.19.2, 2.19.15, 2.19.16 of the <a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf" target="_blank" rel="noopener noreferrer">datasheet</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-and-flash">Build and flash<a href="#build-and-flash" class="hash-link" aria-label="Direct link to Build and flash" title="Direct link to Build and flash">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="build">Build<a href="#build" class="hash-link" aria-label="Direct link to Build" title="Direct link to Build">​</a></h3>
<p>To build a program for the Raspberry Pi Pico, run the following command in the crate&#x27;s root folder (where the <code>Cargo.toml</code> file and <code>src</code> folder are):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cargo</span><span class="token plain"> build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will create the binary file inside <code>target/thumbv6m-none-eabi/debug/</code>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the crate is part of a workspace (as it is the lab template), the <code>target</code> folder is located in the workspace&#x27;s root instead of the crate&#x27;s root.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="flash">Flash<a href="#flash" class="hash-link" aria-label="Direct link to Flash" title="Direct link to Flash">​</a></h3>
<p>To load your program to the Raspberry Pi Pico, connect the board through USB to your computer while holding down the <code>BOOTSEL</code> button. It should appear as an external drive on your system. Afterwards, you can run the following command (also from the crate&#x27;s root folder):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">elf2uf2-rs </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> target/thumbv6m-none-eabi/debug/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">crate_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will upload your program to the Pico.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If you are running this command from within a crate inside of a workspace, don&#x27;t forget to navigate to the target folder by using <code>../../</code>
Example:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">elf2uf2-rs </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/target/thumbv6m-none-eabi/debug/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">crate_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the above command doesn&#x27;t work, try these steps instead:</p><ul>
<li>run this command:</li>
</ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">elf2uf2-rs target/thumbv6m-none-eabi/debug/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">crate_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul>
<li>drag and drop the <code>.uf2</code> file located in the <code>target/thumbv6m-none-eabi/debug/</code> folder to the RP external drive</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="serial-console">Serial console<a href="#serial-console" class="hash-link" aria-label="Direct link to Serial console" title="Direct link to Serial console">​</a></h3>
<p>To see messages from the Pico over the serial port, add the <code>-s</code> argument to the flash command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">elf2uf2-rs </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> /target/thumbv6m-none-eabi/debug/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">crate_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will allow us to see messages sent over serial from the board.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="link-error---reset-vector-is-missing">Link error - reset vector is missing<a href="#link-error---reset-vector-is-missing" class="hash-link" aria-label="Direct link to Link error - reset vector is missing" title="Direct link to Link error - reset vector is missing">​</a></h4>
<p>In case you get an error similar to this:</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Reset Vectors Missing" src="/assets/images/reset_vector_missing_error-75c9e1d7dbe2083d37adbf893b0a5efb.png" width="838" height="314" class="img_ev3q"></p></div>
<p>That means that you most probably forgot to add the <em>entry point</em> to your program. Make sure you add <code>#[entry]</code> before your main function so that the MCU knows to call it at startup.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="flash-succeeds-the-application-does-not-start">Flash succeeds, the application does not start<a href="#flash-succeeds-the-application-does-not-start" class="hash-link" aria-label="Direct link to Flash succeeds, the application does not start" title="Direct link to Flash succeeds, the application does not start">​</a></h4>
<p>In case your code doesn&#x27;t seem to get uploaded correctly or the board goes into <code>BOOTSEL</code> mode as soon as you plug it into your computer, it might be time to debug. To install required dependencies for debugging, run these commands:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rustup component </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> llvm-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cargo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> cargo-binutils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, you can run this command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rust-objdump --section-headers target/thumbv6m-none-eabi/debug/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">crate_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will let us see the layout of the binary file, or the memory of the program that we are about to flash to the board.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Rust ObjDump" src="/assets/images/objdump-be6caf3ea7f7b3a29edada3e1dad98fc.png" width="426" height="580" class="img_ev3q"></p></div>
<p>We need to make sure that it contains the <code>.boot_loader</code> section, or else our program will never run.</p>
<p>Further reading: <a href="/docs/tutorials/embassy">Embassy Tutorial</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercises">Exercises<a href="#exercises" class="hash-link" aria-label="Direct link to Exercises" title="Direct link to Exercises">​</a></h2>
<ol>
<li>Use <a href="https://www.kicad.org/" target="_blank" rel="noopener noreferrer">KiCad</a> to design a simple circuit that connects an LED to GPIO 0 (GP0). (<strong>1p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The maximum current that GPIO pins output depends on the MCU. To be sure that the LED will work normally and there is no risk of destruction, a resistor has to be added to limit the current level <em>below</em> the maximum GPIO output current.</p></div></div>
<ol start="2">
<li>Write a program using Embassy that set on HIGH the LED connected to GPIO pin 0 (GP0). (<strong>2p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Please make sure the lab professor verifies your circuit before it is powered up.</p></div></div>
<ol start="3">
<li>Write a program using Embassy that blinks the LED connected to GPIO pin 0 (GP0) every 300ms. (<strong>2p</strong>)</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>For the purpose of this lab, please use <code>await</code> as is, think that for using the <code>Timer</code>, you have to add <code>.await</code> after the <code>after</code> function.</p></div></div>
<ol start="4">
<li>Write a program using <code>embassy-rs</code> that will write the message &quot;The button was pressed&quot; to the console every time button A is pressed. Take a look at the Pico Explorer Base&#x27;s pinout to determine the pin to which button A is connected. (<strong>2p</strong>)</li>
</ol>
<div align="center"><p><img decoding="async" loading="lazy" alt="Pico Explorer Pinout" src="/assets/images/explorer_pins-826d67f02154207c1b67514ed209149a.jpg" width="800" height="600" class="img_ev3q"></p></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The Raspberry Pi Pico does not have an integrated debugger, so writing messages to the console is done
with a simulated serial port over the USB. This implies the usage of a USB driver.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">embassy_rp</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">usb</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">Driver</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">InterruptHandler</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">embassy_rp</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">bind_interrupts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">peripherals</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token constant" style="color:#36acaa">USB</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">log</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Use for the serial over USB driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property" style="color:#36acaa">bind_interrupts!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Irqs</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">USBCTRL_IRQ</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token class-name">InterruptHandler</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">USB</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// The task used by the serial port driver </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// over USB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[embassy_executor::task]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">logger_task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Driver</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">&#x27;static</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">USB</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token namespace" style="opacity:0.7">embassy_usb_logger</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token macro property" style="color:#36acaa">run!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">log</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">LevelFilter</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Info</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> driver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[embassy_executor::main]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spawner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Spawner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> peripherals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">embassy_rp</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Start the serial port over USB driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> driver </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Driver</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peripherals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">USB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Irqs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spawner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">logger_task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">driver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">info!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Make sure you sleep while looping to read the button&#x27;s value, otherwise
the USB driver&#x27;s task will not be able to run and the messages will
not be printed.</p></div></div></div></div>
<p>:::</p>
<ol start="5">
<li>
<p>Write a Rust program using <code>embassy-rs</code> that toggles the LED every time button A is pressed. (<strong>1p</strong>)</p>
</li>
<li>
<p>Write a Rust program that sets on HIGH the LED connected to GPIO pin 0 (GP0). (<strong>1p</strong>)</p>
<ol>
<li>use the <code>rp2040-pac</code> crate</li>
<li>use bare metal</li>
</ol>
</li>
<li>
<p>Write a Rust program that blinks the LED connected to GPIO pin 0 (GP0) every 300ms. (<strong>1p</strong>)</p>
<ol>
<li>use the <code>rp2040-pac</code> crate - write a <code>PinDriver</code> that implements the <a href="https://docs.rs/embedded-hal/latest/embedded_hal/digital/trait.OutputPin.html" target="_blank" rel="noopener noreferrer"><code>OutputPin</code></a> trait</li>
<li>use bare metal - write a <code>PinDriver</code> that implements the <a href="https://docs.rs/embedded-hal/latest/embedded_hal/digital/trait.OutputPin.html" target="_blank" rel="noopener noreferrer"><code>OutputPin</code></a> trait</li>
</ol>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-topics">Advanced topics<a href="#advanced-topics" class="hash-link" aria-label="Direct link to Advanced topics" title="Direct link to Advanced topics">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="debouncing-techniques-for-stable-input-reading">Debouncing techniques for stable input reading.<a href="#debouncing-techniques-for-stable-input-reading" class="hash-link" aria-label="Direct link to Debouncing techniques for stable input reading." title="Direct link to Debouncing techniques for stable input reading.">​</a></h3>
<p>Noise is produced whenever a pushbutton or other switch is moved. Because the switch contact is made of metal and has some elasticity, there is some noise (contact). The switch literally bounces a few times once it makes contact with a metal surface when it is shifted into a new position. This contact is known as bounce.</p>
<div align="center"><p><img decoding="async" loading="lazy" alt="Button Bounce" src="data:image/png;base64,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" width="512" height="289" class="img_ev3q"></p></div>
<p>The image above shows the signal produced by a button when pressed.</p>
<p>The most correct way to correct the bouncing problem is the hardware one, but there are also software methods to correct the problem. For more details and examples, consult the documentation from Embassy-rs and the examples provided by them.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/UPB-FILS-MA/upb-fils-ma.github.io/edit/main/docs/lab/02/02.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/lab/01"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">01 - Hardware Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/lab/03"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">03 - Exceptions &amp; Interrupts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li><li><a href="#what-is-gpio" class="table-of-contents__link toc-highlight">What is GPIO?</a></li><li><a href="#configuring-gpio-pins" class="table-of-contents__link toc-highlight">Configuring GPIO Pins</a></li><li><a href="#hardware-access" class="table-of-contents__link toc-highlight">Hardware access</a></li><li><a href="#embedded-hal-implementation" class="table-of-contents__link toc-highlight">Embedded HAL Implementation</a><ul><li><a href="#embassy-rs-framework" class="table-of-contents__link toc-highlight">Embassy-rs framework</a></li><li><a href="#entry" class="table-of-contents__link toc-highlight">Entry</a></li><li><a href="#configure-gpio-output" class="table-of-contents__link toc-highlight">Configure GPIO Output</a></li><li><a href="#configure-gpio-input" class="table-of-contents__link toc-highlight">Configure GPIO Input</a></li><li><a href="#waiting" class="table-of-contents__link toc-highlight">Waiting</a></li></ul></li><li><a href="#platform-access-crate-pac" class="table-of-contents__link toc-highlight">Platform Access Crate (PAC)</a><ul><li><a href="#no-std" class="table-of-contents__link toc-highlight">no-std</a></li><li><a href="#bootloader" class="table-of-contents__link toc-highlight">Bootloader</a></li><li><a href="#entry-1" class="table-of-contents__link toc-highlight">Entry</a></li><li><a href="#configuring-the-sio" class="table-of-contents__link toc-highlight">Configuring the SIO</a></li><li><a href="#configuring-the-io-bank0" class="table-of-contents__link toc-highlight">Configuring the IO Bank0</a></li><li><a href="#configuring-the-pad" class="table-of-contents__link toc-highlight">Configuring the Pad</a></li><li><a href="#wait-for-an-amount-of-time" class="table-of-contents__link toc-highlight">Wait for an amount of time</a></li></ul></li><li><a href="#bare-metal" class="table-of-contents__link toc-highlight">Bare metal</a><ul><li><a href="#configuring-the-sio-1" class="table-of-contents__link toc-highlight">Configuring the SIO</a></li></ul></li><li><a href="#build-and-flash" class="table-of-contents__link toc-highlight">Build and flash</a><ul><li><a href="#build" class="table-of-contents__link toc-highlight">Build</a></li><li><a href="#flash" class="table-of-contents__link toc-highlight">Flash</a></li><li><a href="#serial-console" class="table-of-contents__link toc-highlight">Serial console</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li><li><a href="#exercises" class="table-of-contents__link toc-highlight">Exercises</a></li><li><a href="#advanced-topics" class="table-of-contents__link toc-highlight">Advanced topics</a><ul><li><a href="#debouncing-techniques-for-stable-input-reading" class="table-of-contents__link toc-highlight">Debouncing techniques for stable input reading.</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Materials</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/lecture">Lecture</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/lab">Lab</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/project">Project</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/upb-fils-ma" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 <a href="https://wyliodrin.com" target="_blank">Wyliodrin SRL</a>, licensed under CC BY-SA 4.0.</div></div></div></footer></div>
</body>
</html>